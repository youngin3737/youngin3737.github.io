<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X9ZS7RK2T7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-X9ZS7RK2T7');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YounginKim</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>    <!-- Google Fonts: Poppins -->
    <script>
    tailwind.config = {
        darkMode: 'class'
    }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom Styles & Animations */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa; /* Default light background */
        }
        
        .dark body {
            background-color: #111827; /* Default dark background */
        }

        /* Keyframes for the moving gradient background */
        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Hero section with a special animated background */
        #home {
            background-color: #111827;
            background-image: radial-gradient(at 8% 13%, hsla(45, 90%, 60%, 0.38) 0px, transparent 50%),
                              radial-gradient(at 86% 27%, hsla(35, 90%, 65%, 0.35) 0px, transparent 50%),
                              radial-gradient(at 22% 83%, hsla(283,70%,63%,0.35) 0px, transparent 50%);
            background-size: 200% 200%;
            animation: moveGradient 20s ease infinite;
            position: fixed; /* Make it fixed to stay during scroll-fade */
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden; /* Clip ripple effect within viewport */
            z-index: 1; /* Behind the main content */
        }
        
        #home-content-wrapper {
             transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }

        /* This div pushes the main content down by 100vh */
        #hero-spacer {
            height: 100vh;
        }

        /* Main content wrapper that will scroll over the hero */
        #main-content {
            position: relative;
            z-index: 10; /* In front of the hero section */
        }

        /* Scroll-triggered fade-in animation */
        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom gradient text for hero section */
        .gradient-text {
            background: linear-gradient(90deg, #fde047, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        
        /* Dynamic Abstract Animation */
        .abstract-container {
            max-height: 0;
            opacity: 0;
            transform: translateY(-10px) scaleY(0.98);
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        opacity 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        margin-top 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .abstract-container.show {
            opacity: 1;
            transform: translateY(0) scaleY(1);
            margin-top: 1rem;
        }

        /* Animated Search Bar */
        #search-input {
            width: 0;
            padding-left: 0;
            padding-right: 0;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            outline: none; /* Remove default focus outline */
        }
        #search-bar-container.expanded #search-input {
            width: 280px; /* Expanded width */
            padding-left: 1.25rem;
            padding-right: 3rem; /* Space for the icon */
        }
        #search-bar-container {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        /* Add a soft glow when the search bar is focused */
        #search-bar-container:focus-within {
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.5);
        }

                /* Publication Item Filter Animation */
        .publication-item, .year-section, #no-results-message {
            transition: opacity 0.38s ease,
                        transform 0.38s ease,
                        max-height 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        padding 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        margin 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        border-width 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
            max-height: var(--mh, 1400px); /* JS will keep this synced to content height */
            will-change: max-height, opacity, transform;
        }

        .hidden-filter {
            opacity: 0;
            transform: scale(0.95);
            max-height: 0 !important;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
            border-width: 0 !important;
        }

        /* Tag Color System */
        .tag- { background-color: #6b7280; color: white; }
        .tag-inputdevice { background-color: #f59e0b; color: white; } /* Amber-500 */
        .tag-haptic { background-color: #8b5cf6; color: white; } /* Violet-500 */
        .tag-VRAR { background-color: #10b981; color: white; } /* Emerald-500 */
        .tag-locomotion { background-color: #ff5cce; color: white; } /* Violet-500 */
        .tag-MLDL { background-color: #00bbff; color: white; } /* Emerald-500 */

        .tag-btn {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .dark .tag-btn {
            background-color: #374151;
            color: #d1d5db;
        }
        .tag-btn.active {
            color: white !important;
        }
        .tag-btn.active.tag-all { background-color: #4b5563; }
        .tag-btn.active.tag-inputdevice { background-color: #d97706; } /* Amber-600 */
        .tag-btn.active.tag-haptic { background-color: #7c3aed; } /* Violet-600 */
        .tag-btn.active.tag-VRAR { background-color: #059669; } /* Emerald-600 */
        .tag-btn.active.tag-locomotion { background-color: #943577; } /* Violet-600 */
        .tag-btn.active.tag-MLDL { background-color: #3d95b4; } /* Emerald-600 */ 

        .dark .tag-btn.active.tag-all { background-color: #6b7280; }
        .dark .tag-btn.active.tag-inputdevice { background-color: #f59e0b; }
        .dark .tag-btn.active.tag-haptic { background-color: #8b5cf6; }
        .dark .tag-btn.active.tag-VRAR { background-color: #10b981; }
        .tag-btn.active.tag-locomotion { background-color: #ff5cce; } /* Violet-600 */
        .tag-btn.active.tag-MLDL { background-color: #00bbff; } /* Emerald-600 */

        .publication-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* HERO click ripple effect */
        #hero-ripple-container {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 2; /* Above background, below hero content */
        }
        .hero-ripple {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 9999px;
            left: 0;
            top: 0;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0.9;
            border: 2px solid rgba(255, 255, 255, 0.35);
            box-shadow: 0 0 24px rgba(245, 158, 11, 0.25);
            mix-blend-mode: screen;
            animation: heroRipple 1.25s ease-out forwards;
            will-change: transform, opacity;
        }
        .hero-ripple::after {
            content: "";
            position: absolute;
            inset: -7px;
            border-radius: 9999px;
            border: 1px solid rgba(245, 158, 11, 0.35);
            opacity: 0.75;
        }
        @keyframes heroRipple {
            0%   { transform: translate(-50%, -50%) scale(0); opacity: 0.85; }
            100% { transform: translate(-50%, -50%) scale(var(--ripple-scale, 18)); opacity: 0; }
        }

        /* Research cards hover highlight */
        .research-card {
            border: 1px solid transparent;
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
        }
        .research-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 18px 50px rgba(0, 0, 0, 0.08);
            border-color: rgba(245, 158, 11, 0.55);
        }
        .dark .research-card:hover {
            box-shadow: 0 18px 50px rgba(0, 0, 0, 0.35);
            border-color: rgba(252, 211, 77, 0.28);
        }

        /* News cards hover highlight */
        .news-card {
            border: 1px solid transparent;
            transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease;
        }
        .news-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.08);
            border-color: rgba(245, 158, 11, 0.45);
        }
        .dark .news-card:hover {
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.35);
            border-color: rgba(252, 211, 77, 0.24);
        }

        /* Publication thumbnail */
        .pub-thumb {
            border: 1px solid rgba(229, 231, 235, 0.7); /* gray-200 */
        }
        .dark .pub-thumb {
            border-color: rgba(55, 65, 81, 0.9); /* gray-700 */
        }

    
        /* Publication thumbnail hover preview (0.5s delay) */
        .pub-thumb {
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
        }
        .pub-thumb.preview-active {
            transform: scale(1.03);
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.18);
            border-color: rgba(245, 158, 11, 0.55);
        }
        .dark .pub-thumb.preview-active {
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.42);
            border-color: rgba(252, 211, 77, 0.32);
        }
        #pub-image-preview {
            position: fixed;
            left: 0;
            top: 0;
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px) scale(0.98);
            transition: opacity 0.18s ease, transform 0.18s ease;
        }
        #pub-image-preview.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        #pub-image-preview .preview-box {
            border-radius: 14px;
            overflow: hidden;
            border: 1px solid rgba(245, 158, 11, 0.35);
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.22);
        }
        .dark #pub-image-preview .preview-box {
            background: rgba(17, 24, 39, 0.82);
            border-color: rgba(252, 211, 77, 0.24);
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.45);
        }
        #pub-image-preview img {
            display: block;
            max-width: min(560px, 82vw);
            max-height: min(440px, 72vh);
            object-fit: contain;
        }


        /* ------------------------------------------------------------
           News Timeline (Index Page)
        ------------------------------------------------------------ */
        .news-timeline {
            position: relative;
            padding-left: 2.75rem; /* space for line + markers */
            display: flex;
            flex-direction: column;
            gap: 0.65rem;
        }
        .news-timeline::before {
            content: "";
            position: absolute;
            left: 1.05rem;
            top: 0.15rem;
            bottom: 0.15rem;
            width: 1px;
            background: rgba(203, 213, 225, 0.9); /* slate-300-ish */
        }
        .dark .news-timeline::before {
            background: rgba(71, 85, 105, 0.85); /* slate-600-ish */
        }

        .news-timeline-item {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.48rem 0.9rem;
            border-radius: 0.95rem;
            border: 1px solid rgba(226, 232, 240, 0.95);
            background: rgba(255, 255, 255, 0.86);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.045);
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
        }
        .dark .news-timeline-item {
            border-color: rgba(55, 65, 81, 0.95);
            background: rgba(31, 41, 55, 0.78);
            box-shadow: 0 2px 14px rgba(0, 0, 0, 0.28);
        }

        .news-timeline-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 26px rgba(0, 0, 0, 0.08);
            border-color: rgba(245, 158, 11, 0.45);
        }
        .dark .news-timeline-item:hover {
            box-shadow: 0 14px 32px rgba(0, 0, 0, 0.38);
        }

        .news-timeline-marker {
            position: absolute;
            left: 1.05rem;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 9999px;
            background: #f59e0b; /* amber-500 */
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.92);
        }
        .dark .news-timeline-marker {
            box-shadow: 0 0 0 4px rgba(17, 24, 39, 0.95);
        }

        .news-timeline-date {
            font-size: 0.74rem;
            font-weight: 700;
            color: #6b7280; /* gray-500 */
            min-width: 84px;
            letter-spacing: 0.2px;
        }
        .dark .news-timeline-date {
            color: #94a3b8; /* slate-400 */
        }

        .news-timeline-title {
            font-size: 0.90rem; /* smaller than before */
            font-weight: 600;
            color: #111827;
            line-height: 1.25;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .dark .news-timeline-title { color: #f3f4f6; }

        .news-timeline-item:hover .news-timeline-title { color: #d97706; } /* amber-600 */
        .dark .news-timeline-item:hover .news-timeline-title { color: #fcd34d; } /* amber-300 */


        /* ------------------------------------------------------------
           Publications View Toggle + Compact Mode
        ------------------------------------------------------------ */
        .pub-view-btn {
            width: 42px;
            height: 42px;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(229, 231, 235, 1);
            background: rgba(255, 255, 255, 0.86);
            color: rgba(75, 85, 99, 1);
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease, background-color 0.18s ease, color 0.18s ease;
            user-select: none;
        }
        .dark .pub-view-btn {
            border-color: rgba(75, 85, 99, 1);
            background: rgba(55, 65, 81, 0.65);
            color: rgba(229, 231, 235, 1);
        }
        .pub-view-btn:hover {
            border-color: rgba(245, 158, 11, 0.55);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.16);
            transform: translateY(-1px);
        }
        .pub-view-btn.active {
            background: rgba(245, 158, 11, 1);
            border-color: rgba(245, 158, 11, 1);
            color: #ffffff;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.16);
            transform: none;
        }
        .dark .pub-view-btn.active {
            background: rgba(245, 158, 11, 0.96);
            border-color: rgba(245, 158, 11, 0.96);
            color: #111827;
        }

        /* link groups inside publication cards */
        .pub-links-compact { display: none; }
        .pub-link-text {
            font-size: 0.90rem;
            font-weight: 700;
            text-decoration: underline;
            text-underline-offset: 3px;
            color: #d97706; /* amber-600 */
            opacity: 0.95;
        }
        .pub-link-text:hover { opacity: 1; }
        .dark .pub-link-text { color: #fcd34d; }

        /* Compact view overrides */
        #publications.pub-compact .pub-thumb { display: none !important; }
        #publications.pub-compact .pub-tags-row { display: none !important; }
        #publications.pub-compact .abstract-container { 
            display: none !important;
            max-height: 0 !important;
            opacity: 0 !important;
            margin-top: 0 !important;
        }

        #publications.pub-compact .publication-item {
            padding: 0.9rem 1rem !important;
        }
        #publications.pub-compact .pub-top {
            gap: 0.75rem !important;
            flex-direction: row !important;
            flex-wrap: wrap;
            align-items: flex-start;
        }
        #publications.pub-compact .pub-links {
            margin-top: 0 !important;
        }
        #publications.pub-compact .publication-title {
            font-size: 1.05rem !important;
        }
        #publications.pub-compact .pub-authors {
            font-size: 0.90rem !important;
            margin-top: 0.25rem !important;
        }
        #publications.pub-compact .pub-venue {
            font-size: 0.82rem !important;
            margin-top: 0.12rem !important;
        }

        #publications.pub-compact .pub-links-detailed { display: none !important; }
        #publications.pub-compact .pub-links-compact { 
            display: flex !important;
            gap: 0.9rem;
            flex-wrap: wrap;
            justify-content: flex-start;
        }
</style>
    <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        if (localStorage.getItem('color-theme') === 'dark') {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.add('light');
        }
    </script>
</head>
<body class="light">

    <!-- Header & Navigation -->
    <header id="header" class="text-white fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold">YoungIn Kim</a>
            <div class="flex items-center space-x-4">
                <ul class="hidden md:flex items-center space-x-8">
                    <li><a href="#about" class="nav-link font-semibold">About</a></li>
                    <li><a href="#research" class="nav-link font-semibold">Interests</a></li>
                    <li><a href="#news" class="nav-link font-semibold">News</a></li>
                    <li><a href="#publications" class="nav-link font-semibold">Publications</a></li>
                    <li><a href="#contact" class="nav-link font-semibold">Contact</a></li>
                </ul>
                <button id="theme-toggle" type="button" class="text-gray-400 hover:text-white focus:outline-none rounded-lg text-sm p-2.5">
                    <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                </button>
                <button id="mobile-menu-button" class="md:hidden">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm text-gray-900 dark:text-white border-t border-gray-200/70 dark:border-gray-700/70">
             <a href="#about" class="block py-2">About</a>
             <a href="#research" class="block py-2">Interests</a>
             <a href="#news" class="block py-2">News</a>
             <a href="#publications" class="block py-2">Publications</a>
             <a href="#contact" class="block py-2">Contact</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home">
        <div id="hero-ripple-container" aria-hidden="true"></div>
        <div id="home-content-wrapper" class="h-full flex flex-col items-center justify-center text-white relative z-10">
            <div class="container mx-auto px-6 text-center flex-grow flex flex-col items-center justify-center">
                <h1 class="text-4xl md:text-6xl font-bold leading-tight mb-4">
                    Researching Devices that
                    <br>
                    <span class="gradient-text"> Make Our Lives Fun</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto">
                    HCI researcher exploring novel devices to enhance user experiences in Desktop, Laptop, VR/AR, and so on.
                </p>
                <a href="#about" class="mt-8 inline-block bg-amber-500 text-white font-bold rounded-lg px-8 py-3 hover:bg-amber-600 transition-all duration-300 shadow-lg hover:shadow-amber-500/50 transform hover:scale-105">
                    Explore My Work
                </a>
            </div>
            <!-- Latest News Floating Box -->
            <a id="hero-latest-news-float" href="#news" class="latest-news-float bg-gray-900/50 hover:bg-gray-900/80 transition-colors w-11/12 md:w-auto max-w-2xl p-4 rounded-xl mb-8">
                <p class="text-sm font-semibold text-gray-200">
                    <span class="font-bold text-amber-300">Latest News:</span>
                    <span id="hero-latest-news-title">Loading...</span>
                </p>
            </a>
        </div>
    </section>

    <!-- This div creates space for the fixed hero section -->
    <div id="hero-spacer"></div>

    <!-- Main Content Wrapper -->
    <div id="main-content" class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-500">
        <main>
            <!-- About Me Section -->
            <section id="about" class="py-20 fade-in-section">
                 <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">About Me</h2>
                        <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    </div>
                    <div class="flex flex-col md:flex-row items-center gap-12">
                        <div class="md:w-1/3 text-center">
                            <img src="images/kyi_profile.png" alt="Young-in's Portrait" class="rounded-full shadow-lg mx-auto w-64 h-64 object-cover">
                        </div>
                        <div class="md:w-2/3">
                            <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
                                Hello, I’m now a Master’s Student in School of Copmuting, KAIST. I am currently part of the 
                                <a href="https://hcil.kaist.ac.kr/" target="_blank" class="text-amber-500 hover:underline"><strong>Human-Computer Interaction Lab (HCIL)</strong></a>, 
                                advised by 
                                <a href="https://cs.kaist.ac.kr/people/view?idx=372&kind=faculty&menu=172" target="_blank" class="text-amber-500 hover:underline"><strong>Prof. Geehyuk Lee</strong></a>.
                            </p>
                            <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
                                I am recently interested in discovering various <strong>Haptic Devices</strong> for VR and AR devices for more immersive and interesting user experiences.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Research Interests Section -->
            <section id="research" class="py-20 bg-white dark:bg-gray-800 fade-in-section">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">Research Interests</h2>
                        <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    </div>
                    <div class="grid md:grid-cols-3 gap-8 text-center">
                        <div class="research-card group p-8 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm">
                            <i class="fas fa-keyboard text-4xl text-amber-500 dark:text-amber-400 mb-4 transition-transform duration-300 group-hover:scale-110"></i>
                            <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Input Devices</h3>
                            <p class="text-gray-600 dark:text-gray-400">Exploring more convenient and useful new input devices.</p>
                        </div>
                        <div class="research-card group p-8 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm">
                            <i class="fas fa-user-gear text-4xl text-amber-500 dark:text-amber-400 mb-4 transition-transform duration-300 group-hover:scale-110"></i>
                            <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Haptics</h3>
                            <p class="text-gray-600 dark:text-gray-400">Providing more diverse and realistic haptic feedback, and exploring human perception models of haptics.</p>
                        </div>
                        <div class="research-card group p-8 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm">
                            <i class="fas fa-vr-cardboard text-4xl text-amber-500 dark:text-amber-400 mb-4 transition-transform duration-300 group-hover:scale-110"></i>
                            <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">VR/AR</h3>
                            <p class="text-gray-600 dark:text-gray-400">Making VR/AR/XR environments more immersive and realistic</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- News Section -->
            <section id="news" class="py-20 fade-in-section">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">News</h2>
                        <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    </div>

                    <div class="max-w-3xl mx-auto">
                        <div id="news-loading" class="text-center py-10 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
                            <p class="text-sm font-semibold">Loading news...</p>
                        </div>

                        <div id="news-list" class="news-timeline"></div>

                        <div id="news-empty" class="hidden text-center py-10">
                            <i class="fas fa-newspaper text-3xl text-gray-400 mb-3"></i>
                            <p class="text-gray-500 dark:text-gray-400">No news posts yet.</p>
                        </div>

                        <div class="mt-10 text-center">
                            <a href="news.html" class="inline-flex items-center gap-2 bg-amber-500 text-white font-bold rounded-lg px-6 py-3 hover:bg-amber-600 transition-all duration-300 shadow-lg hover:shadow-amber-500/30 transform hover:scale-105">
                                View all News <i class="fas fa-arrow-right text-sm"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Publications Section -->
            <section id="publications" class="py-20 bg-white dark:bg-gray-800 fade-in-section">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">Publications</h2>
                        <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    </div>

                    <!-- Search and Filter Controls -->
                    <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-12">
                        <!-- Search Bar -->
                        <div id="search-bar-container" class="relative flex items-center bg-white dark:bg-gray-700 rounded-full shadow-sm">
                            <input type="text" id="search-input" placeholder="Search titles..." class="h-12 border-none bg-transparent focus:ring-0 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                            <button id="search-icon" class="absolute right-0 top-0 h-full px-4 text-gray-600 dark:text-gray-300 hover:text-amber-500 dark:hover:text-amber-400 focus:outline-none">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <!-- Tag Filter Buttons -->
                        <div id="tag-filter-container" class="flex justify-center flex-wrap gap-3">
                            <button class="tag-btn active tag-all" data-tag="all">All</button>
                            <button class="tag-btn tag-inputdevice" data-tag="inputdevice">Input Device</button>
                            <button class="tag-btn tag-haptic" data-tag="haptic">Haptic</button>
                            <button class="tag-btn tag-VRAR" data-tag="vrar">VR/AR</button>
                            <button class="tag-btn tag-locomotion" data-tag="locomotion">Locomotion</button>
                            <button class="tag-btn tag-MLDL" data-tag="mldl">MLDL</button>
                        </div>
                        <!-- View Mode Toggle -->
                        <div id="pub-view-toggle" class="flex items-center gap-2">
                            <button id="pub-view-detailed" type="button" class="pub-view-btn active" aria-label="Detailed view" title="Detailed view">
                                <i class="fas fa-table-cells-large"></i>
                            </button>
                            <button id="pub-view-compact" type="button" class="pub-view-btn" aria-label="Compact view" title="Compact view">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>

                    
                    <!-- Publications List (generated from JSON: data/publications.json) -->
                    <div id="publications-loading" class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                        <p class="text-lg">Loading publications...</p>
                        <p class="mt-2 text-sm text-gray-500 dark:text-gray-500">
                            Tip: 로컬에서 file://로 열면 JSON 로딩이 막힐 수 있어요. (GitHub Pages 등) 웹서버로 띄우면 정상 동작합니다.
                        </p>
                    </div>

                    <div id="publications-content" class="space-y-8 hidden">
                        <div id="publications-list" class="space-y-8"></div>

                        <!-- No Results Message -->
                        <div id="no-results-message" class="hidden-filter text-center py-12">
                            <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                            <p class="text-xl text-gray-500 dark:text-gray-400">No publications found matching your criteria.</p>
                        </div>

                    </div>

                </div>
            </section>
            
            <!-- Contact Section -->
            <section id="contact" class="py-20 fade-in-section">
                 <div class="container mx-auto px-6 text-center">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">Get In Touch</h2>
                    <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    <p class="mt-6 text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                        If you have any questions about my research, feel free to reach out.
                    </p>
                    <div class="mt-8 flex justify-center items-center space-x-6 text-2xl">
                        <a href="mailto:youngin@kaist.ac.kr" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors"><i class="fas fa-envelope"></i></a>
                        <a href="https://github.com/youngin3737" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors"><i class="fab fa-github"></i></a>
                        <a href="https://www.linkedin.com/in/youngin-kim-48624a2a2" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors"><i class="fab fa-linkedin"></i></a>
                        <a href="https://scholar.google.com/citations?user=sPl0gUgAAAAJ" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors"><i class="fas fa-graduation-cap"></i></a>
                        <a href="assets/CV.pdf" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors" aria-label="CV"><i class="fas fa-file-pdf"></i></a>

                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 dark:bg-black text-white py-6">
            <div class="container mx-auto px-6 text-center">
                <p>&copy; <span id="year"></span> YoungIn Kim. All Rights Reserved.</p>
            </div>
        </footer>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Set current year in footer
            document.getElementById('year').textContent = new Date().getFullYear();

            // Mobile menu toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            const header = document.getElementById('header');
            const homeContentWrapper = document.getElementById('home-content-wrapper');

            // --- SCROLL-BASED ANIMATIONS ---
            window.addEventListener('scroll', () => {
                const scrollY = window.scrollY;
                const viewportHeight = window.innerHeight;

                // 1. Hero Section Fade-out Animation
                const fadeEnd = viewportHeight * 0.8;
                let opacity = 1 - (scrollY / fadeEnd);
                opacity = Math.max(0, Math.min(1, opacity)); // Clamp between 0 and 1

                if (homeContentWrapper) {
                    homeContentWrapper.style.opacity = opacity;
                    homeContentWrapper.style.transform = `scale(${1 - (scrollY / (viewportHeight * 4))})`;
                }

                // 2. Header Style Change
                if (scrollY > 50) {
                    header.classList.add(
                        'bg-white/80', 'dark:bg-gray-900/80',
                        'backdrop-blur-md', 'shadow-sm',
                        'text-gray-800', 'dark:text-gray-200'
                    );
                    header.classList.remove('text-white');
                } else {
                    header.classList.remove(
                        'bg-white/80', 'dark:bg-gray-900/80',
                        'backdrop-blur-md', 'shadow-sm',
                        'text-gray-800', 'dark:text-gray-200'
                    );
                    header.classList.add('text-white');
                }
            });

            // Intersection Observer for fade-in animations for other sections
            const sections = document.querySelectorAll('.fade-in-section');
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            sections.forEach(section => {
                observer.observe(section);
            });

            // Active navigation link highlighting on scroll
            const navLinks = document.querySelectorAll('.nav-link');
            const allSections = document.querySelectorAll('#main-content section');

            const activateNavOnScroll = () => {
                let current = '';
                allSections.forEach(section => {
                    const sectionTop = section.offsetTop + document.getElementById('main-content').offsetTop;
                    if (pageYOffset >= sectionTop - 100) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            };
            window.addEventListener('scroll', activateNavOnScroll);

            // Dark Mode Toggle Script
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
            const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
            const htmlEl = document.documentElement;

            function setTheme(theme) {
                htmlEl.classList.remove('light', 'dark');
                htmlEl.classList.add(theme);
                localStorage.setItem('color-theme', theme);

                if (theme === 'dark') {
                    themeToggleLightIcon.classList.remove('hidden');
                    themeToggleDarkIcon.classList.add('hidden');
                } else {
                    themeToggleDarkIcon.classList.remove('hidden');
                    themeToggleLightIcon.classList.add('hidden');
                }
                window.dispatchEvent(new Event('scroll'));
            }

            if (localStorage.getItem('color-theme') === 'dark') {
                setTheme('dark');
            } else {
                setTheme('light');
            }

            themeToggleBtn.addEventListener('click', () => {
                const currentTheme = htmlEl.classList.contains('dark') ? 'light' : 'dark';
                setTheme(currentTheme);
            });

            // --- HERO click ripple effect ---
            const homeSection = document.getElementById('home');
            const rippleContainer = document.getElementById('hero-ripple-container');

            if (homeSection && rippleContainer) {
                homeSection.addEventListener('pointerdown', (e) => {
                    // Only left click for mouse
                    if (e.pointerType === 'mouse' && e.button !== 0) return;

                    const rect = homeSection.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    // Max distance to a corner -> ripple scale
                    const maxX = Math.max(x, rect.width - x);
                    const maxY = Math.max(y, rect.height - y);
                    const maxDist = Math.sqrt(maxX * maxX + maxY * maxY);

                    const baseSize = 16; // matches .hero-ripple size
                    const scale = Math.max(10, maxDist / baseSize);

                    const ripple = document.createElement('span');
                    ripple.className = 'hero-ripple';
                    ripple.style.left = `${x}px`;
                    ripple.style.top = `${y}px`;
                    ripple.style.setProperty('--ripple-scale', scale.toFixed(2));

                    rippleContainer.appendChild(ripple);
                    ripple.addEventListener('animationend', () => ripple.remove(), { once: true });
                }, { passive: true });
            }

            // --- Publications: load + render from JSON (data/publications.json) ---
            const publicationsLoading = document.getElementById('publications-loading');
            const publicationsContent = document.getElementById('publications-content');
            const publicationsList = document.getElementById('publications-list');

            const TAG_META = {
                inputdevice: { label: 'Input Device', cls: 'tag-inputdevice' },
                haptic: { label: 'Haptic', cls: 'tag-haptic' },
                vrar: { label: 'VR/AR', cls: 'tag-VRAR' },
                locomotion: { label: 'Locomotion', cls: 'tag-locomotion' },
                mldl: { label: 'ML/DL', cls: 'tag-MLDL' }
            };

            const escapeHtml = (unsafe = '') => {
                return String(unsafe)
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            };


            // --- News: load preview (top 5) from JSON (data/news.json) ---
            const newsLoading = document.getElementById('news-loading');
            const newsList = document.getElementById('news-list');
            const newsEmpty = document.getElementById('news-empty');

            
            const heroLatestNewsFloat = document.getElementById('hero-latest-news-float');
            const heroLatestNewsTitle = document.getElementById('hero-latest-news-title');
const formatNewsDate = (iso = '') => {
                const d = new Date(iso);
                if (Number.isNaN(d.getTime())) return iso;
                return d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            };

            const formatNewsMonthYear = (iso = '') => {
                const d = new Date(iso);
                if (Number.isNaN(d.getTime())) return iso;
                return d.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            };

            const buildNewsPreviewItem = (n) => {
                const id = n?.id ? String(n.id) : '';
                const title = n?.title ? String(n.title) : '';
                const dateIso = n?.date ? String(n.date) : '';
                const monthYear = formatNewsMonthYear(dateIso);

                return `
                    <a href="news.html#post-${escapeHtml(id)}" class="news-timeline-item group" aria-label="${escapeHtml(title)} (${escapeHtml(formatNewsDate(dateIso))})">
                        <span class="news-timeline-marker" aria-hidden="true"></span>
                        <span class="news-timeline-date">${escapeHtml(monthYear)}</span>
                        <span class="news-timeline-title">${escapeHtml(title)}</span>
                    </a>
                `;
            };

            const loadNewsPreview = async () => {
                if (!newsList) return;
                try {
                    const res = await fetch('data/news.json', { cache: 'no-store' });
                    if (!res.ok) throw new Error(`Failed to load news.json (${res.status})`);
                    const news = await res.json();

                    const sorted = (news || []).slice().sort((a,b) => new Date(b.date) - new Date(a.date));
                    const top = sorted.slice(0, 5);

                    

                    // Update hero Latest News (title only)
                    const latest = sorted[0];
                    if (heroLatestNewsFloat) {
                        if (!latest || !latest.title) {
                            heroLatestNewsFloat.classList.add('hidden');
                        } else {
                            heroLatestNewsFloat.classList.remove('hidden');
                            if (heroLatestNewsTitle) heroLatestNewsTitle.textContent = String(latest.title);
                            heroLatestNewsFloat.setAttribute('aria-label', `Latest News: ${String(latest.title)}`);
                        }
                    }
if (top.length === 0) {
                        if (newsLoading) newsLoading.classList.add('hidden');
                        if (newsEmpty) newsEmpty.classList.remove('hidden');
                        if (heroLatestNewsFloat) heroLatestNewsFloat.classList.add('hidden');
                        return;
                    }

                    newsList.innerHTML = top.map(buildNewsPreviewItem).join('\n');
                    if (newsLoading) newsLoading.classList.add('hidden');
                } catch (err) {
                    console.error(err);
                    if (heroLatestNewsFloat) heroLatestNewsFloat.classList.add('hidden');
                    if (newsLoading) {
                        newsLoading.innerHTML = `
                            <i class="fas fa-triangle-exclamation text-3xl mb-3 text-amber-500"></i>
                            <p class="text-sm font-semibold">Failed to load news.</p>
                            <p class="mt-2 text-xs text-gray-500 dark:text-gray-500">
                                data/news.json 를 불러오지 못했어요. 웹서버에서 실행하거나 파일 경로/이름을 확인해 주세요.
                            </p>
                        `;
                    }
                }
            };

            loadNewsPreview();
            const buildTagSpans = (tags = []) => {
                return (tags || [])
                    .map(t => {
                        const meta = TAG_META[t];
                        if (!meta) return '';
                        return `<span class="publication-tag ${meta.cls}">${meta.label}</span>`;
                    })
                    .join('\n');
            };

            const buildLinkButtons = (pub) => {
                const detailed = [];
                const compact = [];

                const pushLink = (label, href, detailedClass) => {
                    if (!href) return;
                    detailed.push(`<a href="${escapeHtml(href)}" class="${detailedClass}">${label}</a>`);
                    compact.push(`<a href="${escapeHtml(href)}" class="pub-link-text">${label}</a>`);
                };

                pushLink('DOI', pub.doi, 'bg-amber-500 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-amber-600 transition-colors');
                pushLink('Paper', pub.paper, 'bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-gray-800 transition-colors');
                pushLink('Project', pub.project, 'bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors');

                if (detailed.length === 0) return '';

                return `
                    <div class="pub-links-detailed flex flex-wrap gap-2 justify-start md:justify-end">
                        ${detailed.join('')}
                    </div>
                    <div class="pub-links-compact flex flex-wrap gap-3 justify-start md:justify-end">
                        ${compact.join('')}
                    </div>
                `;
            };

            const buildPublicationItem = (pub) => {
                const tags = Array.isArray(pub.tags) ? pub.tags : [];
                const dataTags = tags.join(' ');
                const thumb = pub.thumbnail ? `
                    <img src="${escapeHtml(pub.thumbnail)}" alt="${escapeHtml(pub.title)} thumbnail" class="w-full h-full object-cover relative z-10" loading="lazy" onerror="this.style.display='none';">
                ` : '';

                const abstractBtn = pub.abstract ? `
                    <button class="abstract-toggle-btn ml-auto bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-300 px-3 py-1 rounded-full text-sm font-semibold hover:bg-amber-200 dark:hover:bg-amber-900">
                        See Abstract
                    </button>
                ` : '';

                const abstractBlock = pub.abstract ? `
                    <div class="abstract-container">
                        <div class="p-4 mt-4 bg-gray-100 dark:bg-gray-700/50 rounded-lg border-l-4 border-amber-400">
                            <p class="abstract-content text-gray-700 dark:text-gray-300 leading-relaxed">
                                ${escapeHtml(pub.abstract)}
                            </p>
                        </div>
                    </div>
                ` : '';

                return `
                    <div class="publication-item bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm flex-col" data-tags="${escapeHtml(dataTags)}">
                        <div class="pub-top flex flex-col md:flex-row items-start gap-6">
                            <div class="pub-thumb relative w-full md:w-40 h-40 md:h-28 rounded-lg overflow-hidden flex-shrink-0 bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                                <i class="fas fa-book-open text-gray-400 dark:text-gray-500 text-3xl absolute"></i>
                                ${thumb}
                            </div>
                            <div class="pub-meta flex-grow min-w-0">
                                <h4 class="publication-title text-xl font-bold text-gray-900 dark:text-white">${escapeHtml(pub.title)}</h4>
                                <p class="pub-authors text-gray-700 dark:text-gray-300 mt-1">${pub.authors || ''}</p>
                                <p class="pub-venue text-gray-500 dark:text-gray-400 italic mt-1">${escapeHtml(pub.venue || '')}</p>
                            </div>
                            <div class="pub-links flex-shrink-0 mt-4 md:mt-0">
                                ${buildLinkButtons(pub)}
                            </div>
                        </div>
                        <div class="pub-tags-row mt-4 flex flex-wrap gap-2 items-center">
                            ${buildTagSpans(tags)}
                            ${abstractBtn}
                        </div>
                        ${abstractBlock}
                    </div>
                `;
            };

            const renderPublications = (pubs) => {
                if (!publicationsList) return;

                // Group by year
                const byYear = {};
                (pubs || []).forEach(pub => {
                    const year = String(pub.year || 'Misc');
                    byYear[year] = byYear[year] || [];
                    byYear[year].push(pub);
                });

                const years = Object.keys(byYear)
                    .filter(y => y !== 'Misc')
                    .sort((a, b) => Number(b) - Number(a));

                if (byYear['Misc']) years.push('Misc');

                const yearBlocks = years.map(year => {
                    const items = byYear[year] || [];
                    const itemsHtml = items.map(buildPublicationItem).join('\n');

                    return `
                        <div class="year-section" data-year="${escapeHtml(year)}">
                            <h3 class="text-2xl font-bold mb-6 text-gray-700 dark:text-gray-300 border-b-2 border-gray-200 dark:border-gray-700 pb-2">${escapeHtml(year)}</h3>
                            <div class="space-y-8">
                                ${itemsHtml}
                            </div>
                        </div>
                    `;
                }).join('\n');

                publicationsList.innerHTML = yearBlocks;
            };

            const initPublicationUI = () => {
                // Search and Filter Controls
                const searchIcon = document.getElementById('search-icon');
                const searchContainer = document.getElementById('search-bar-container');
                const searchInput = document.getElementById('search-input');
                const filterContainer = document.getElementById('tag-filter-container');
                const noResultsMessage = document.getElementById('no-results-message');

                const publicationsSection = document.getElementById('publications');
                const viewDetailedBtn = document.getElementById('pub-view-detailed');
                const viewCompactBtn = document.getElementById('pub-view-compact');

                const isCompactView = () => publicationsSection && publicationsSection.classList.contains('pub-compact');

                // Keep max-height values synced to real content height.
                // This restores smooth filter animations while preventing clipping when abstracts expand.
                const setMH = (el, extra = 0) => {
                    if (!el) return;
                    el.style.setProperty('--mh', (el.scrollHeight + extra) + 'px');
                };

                const getMHExtras = () => {
                    const compact = isCompactView();
                    return {
                        item: compact ? 70 : 120,
                        year: compact ? 150 : 220
                    };
                };

                const refreshPublicationHeights = () => {
                    const ex = getMHExtras();
                    document.querySelectorAll('.publication-item').forEach(el => setMH(el, ex.item));
                    document.querySelectorAll('.year-section').forEach(el => setMH(el, ex.year));
                    setMH(noResultsMessage, ex.item);
                };


                // Expand/Collapse search bar
                if (searchIcon && searchContainer && searchInput) {
                    searchIcon.addEventListener('click', () => {
                        searchContainer.classList.toggle('expanded');
                        if (searchContainer.classList.contains('expanded')) {
                            searchInput.focus();
                        }
                    });

                    // Automatically collapse search bar when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!searchContainer.contains(e.target) && searchInput.value === '') {
                            searchContainer.classList.remove('expanded');
                        }
                    });
                }

                
                // --- Publications view mode toggle (Detailed / Compact) ---
                const applyPublicationViewMode = (mode) => {
                    if (!publicationsSection) return;
                    const compact = mode === 'compact';

                    publicationsSection.classList.toggle('pub-compact', compact);

                    if (viewDetailedBtn) viewDetailedBtn.classList.toggle('active', !compact);
                    if (viewCompactBtn) viewCompactBtn.classList.toggle('active', compact);

                    // In compact view: close any opened abstracts so hidden content doesn't affect height calculations
                    if (compact && publicationsList) {
                        publicationsList.querySelectorAll('.abstract-container.show').forEach(ac => {
                            ac.classList.remove('show');
                            ac.style.maxHeight = '0px';
                        });
                        publicationsList.querySelectorAll('.abstract-toggle-btn').forEach(btn => {
                            btn.textContent = 'See Abstract';
                        });
                    }

                    requestAnimationFrame(refreshPublicationHeights);
                };

                const savedView = (() => {
                    try { return localStorage.getItem('pubViewMode'); } catch (_) { return null; }
                })();

                applyPublicationViewMode(savedView === 'compact' ? 'compact' : 'detailed');

                if (viewDetailedBtn) {
                    viewDetailedBtn.addEventListener('click', () => {
                        try { localStorage.setItem('pubViewMode', 'detailed'); } catch (_) {}
                        applyPublicationViewMode('detailed');
                    });
                }
                if (viewCompactBtn) {
                    viewCompactBtn.addEventListener('click', () => {
                        try { localStorage.setItem('pubViewMode', 'compact'); } catch (_) {}
                        applyPublicationViewMode('compact');
                    });
                }
const filterPublications = () => {
                    const publicationItems = document.querySelectorAll('.publication-item');
                    const yearSections = document.querySelectorAll('.year-section');

                    const searchQuery = (searchInput?.value || '').toLowerCase();
                    const activeTagBtn = filterContainer?.querySelector('.tag-btn.active');
                    const selectedTag = activeTagBtn ? activeTagBtn.dataset.tag : 'all';

                    const ex = getMHExtras();

                    let visibleItemsCount = 0;

                    publicationItems.forEach(item => {
                        setMH(item, ex.item);
                        const title = item.querySelector('.publication-title')?.textContent?.toLowerCase() || '';
                        const tags = item.dataset.tags || '';

                        const searchMatch = title.includes(searchQuery);
                        const tagMatch = selectedTag === 'all' || tags.includes(selectedTag);

                        if (searchMatch && tagMatch) {
                            item.classList.remove('hidden-filter');
                            visibleItemsCount++;
                        } else {
                            item.classList.add('hidden-filter');
                        }
                    });

                    // Hide empty year sections
                    yearSections.forEach(section => {
                        setMH(section, ex.year);
                        const visibleItems = section.querySelectorAll('.publication-item:not(.hidden-filter)');
                        if (visibleItems.length > 0) {
                            section.classList.remove('hidden-filter');
                        } else {
                            section.classList.add('hidden-filter');
                        }
                    });

                    // Show/hide no results message
                    if (noResultsMessage) {
                        if (visibleItemsCount === 0) {
                            noResultsMessage.classList.remove('hidden-filter');
                        } else {
                            noResultsMessage.classList.add('hidden-filter');
                        }
                    }


                    // Sync max-heights after filtering so transitions stay smooth
                    requestAnimationFrame(refreshPublicationHeights);
                };

                // Event listeners
                if (searchInput) searchInput.addEventListener('input', filterPublications);

                if (filterContainer) {
                    filterContainer.addEventListener('click', (e) => {
                        const btn = e.target.closest('button');
                        if (btn && btn.classList.contains('tag-btn') && !btn.classList.contains('active')) {
                            const currentActive = filterContainer.querySelector('.tag-btn.active');
                            if (currentActive) currentActive.classList.remove('active');
                            btn.classList.add('active');

                            // Reset other filter buttons to default style
                            filterContainer.querySelectorAll('.tag-btn').forEach(b => {
                                if (!b.classList.contains('active')) {
                                    b.style.backgroundColor = '';
                                    b.style.color = '';
                                }
                            });

                            filterPublications();
                        }
                    });
                }

                // --- Publication Abstract Toggle (event delegation) ---
                if (publicationsList) {

                    // Helper: animate abstract open/close without clipping the parent (publication item/year-section)
                    const animateAbstract = (publicationItem, abstractContainer, open) => {
                        const yearSection = publicationItem?.closest('.year-section');

                        // Full content height (works even when collapsed)
                        const target = (abstractContainer.scrollHeight + 40);

                        // Make sure containers have enough max-height during the animation (prevents "snap back")
                        if (open) {
                            if (publicationItem) {
                                publicationItem.style.setProperty('--mh', (publicationItem.scrollHeight + target + 180) + 'px');
                            }
                            if (yearSection) {
                                yearSection.style.setProperty('--mh', (yearSection.scrollHeight + target + 260) + 'px');
                            }
                        }

                        // Clean up previous transition handler (if user clicks quickly)
                        if (abstractContainer._yk_onEnd) {
                            abstractContainer.removeEventListener('transitionend', abstractContainer._yk_onEnd);
                            abstractContainer._yk_onEnd = null;
                        }

                        const onEnd = (ev) => {
                            if (ev.propertyName !== 'max-height') return;
                            abstractContainer.removeEventListener('transitionend', onEnd);
                            abstractContainer._yk_onEnd = null;
                            // After animation settles, re-sync heights for smooth filtering + no clipping
                            requestAnimationFrame(refreshPublicationHeights);
                        };
                        abstractContainer._yk_onEnd = onEnd;
                        abstractContainer.addEventListener('transitionend', onEnd);

                        if (open) {
                            abstractContainer.classList.add('show');
                            abstractContainer.style.maxHeight = '0px';
                            // Force reflow so the browser sees 0px -> target transition
                            abstractContainer.offsetHeight;
                            abstractContainer.style.maxHeight = target + 'px';
                        } else {
                            // Set start height explicitly to avoid jumping
                            abstractContainer.style.maxHeight = (abstractContainer.scrollHeight + 40) + 'px';
                            abstractContainer.offsetHeight;
                            abstractContainer.style.maxHeight = '0px';
                            abstractContainer.classList.remove('show');
                        }
                    };

                    publicationsList.addEventListener('click', (e) => {
                        const button = e.target.closest('.abstract-toggle-btn');
                        if (!button) return;

                        const publicationItem = button.closest('.publication-item');
                        const abstractContainer = publicationItem?.querySelector('.abstract-container');
                        if (!abstractContainer) return;

                        const isVisible = abstractContainer.classList.contains('show');

                        if (isVisible) {
                            animateAbstract(publicationItem, abstractContainer, false);
                            button.textContent = 'See Abstract';
                        } else {
                            animateAbstract(publicationItem, abstractContainer, true);
                            button.textContent = 'Hide Abstract';
                        }
                    });

                    // Keep opened abstracts sized correctly on resize
                    window.addEventListener('resize', () => {
                        document.querySelectorAll('.abstract-container.show').forEach(ac => {
                            ac.style.maxHeight = (ac.scrollHeight + 40) + 'px';
                        });
                        requestAnimationFrame(refreshPublicationHeights);
                    });

                    // --- Publication thumbnail hover preview (0.5s delay) ---
                    // Shows full (uncropped) image in a floating popover.
                    const preview = document.createElement('div');
                    preview.id = 'pub-image-preview';
                    preview.innerHTML = `<div class="preview-box"><img alt="Publication preview"></div>`;
                    document.body.appendChild(preview);

                    const previewImg = preview.querySelector('img');
                    const previewBox = preview.querySelector('.preview-box');

                    let hoverTimer = null;
                    let activeThumb = null;

                    const hidePreview = () => {
                        if (hoverTimer) {
                            clearTimeout(hoverTimer);
                            hoverTimer = null;
                        }
                        if (activeThumb) {
                            activeThumb.classList.remove('preview-active');
                            activeThumb = null;
                        }
                        preview.classList.remove('show');
                    };

                    const positionPreview = (thumbEl) => {
                        if (!thumbEl) return;

                        const rect = thumbEl.getBoundingClientRect();
                        const pad = 12;

                        // Ensure we have a measurable box size
                        const w = previewBox.offsetWidth || 360;
                        const h = previewBox.offsetHeight || 260;

                        let x = rect.right + pad;
                        let y = rect.top;

                        // flip horizontally if overflowing
                        if (x + w + pad > window.innerWidth) {
                            x = rect.left - w - pad;
                        }
                        x = Math.max(pad, Math.min(x, window.innerWidth - w - pad));

                        // clamp vertically
                        if (y + h + pad > window.innerHeight) {
                            y = window.innerHeight - h - pad;
                        }
                        y = Math.max(pad, y);

                        preview.style.left = x + 'px';
                        preview.style.top = y + 'px';
                    };

                    const showPreviewFor = (thumbEl) => {
                        if (!thumbEl) return;

                        const img = thumbEl.querySelector('img');
                        // Only show if the thumbnail image exists and is visible (not removed by onerror)
                        if (!img || !img.getAttribute('src') || img.style.display === 'none') return;

                        activeThumb = thumbEl;
                        activeThumb.classList.add('preview-active');

                        previewImg.src = img.getAttribute('src');
                        previewImg.onload = () => {
                            if (activeThumb === thumbEl) positionPreview(thumbEl);
                        };

                        positionPreview(thumbEl);
                        preview.classList.add('show');
                    };

                    publicationsList.addEventListener('pointerover', (e) => {
                        // Desktop hover only
                        if (e.pointerType && e.pointerType !== 'mouse') return;

                        const thumbEl = e.target.closest('.pub-thumb');
                        if (!thumbEl) return;

                        // If hovering same thumb again, do nothing
                        if (activeThumb === thumbEl) return;

                        hidePreview();
                        hoverTimer = setTimeout(() => showPreviewFor(thumbEl), 500);
                    });

                    publicationsList.addEventListener('pointerout', (e) => {
                        if (e.pointerType && e.pointerType !== 'mouse') return;

                        const thumbEl = e.target.closest('.pub-thumb');
                        if (!thumbEl) return;

                        // Only hide when leaving the thumb element
                        if (thumbEl && !thumbEl.contains(e.relatedTarget)) {
                            hidePreview();
                        }
                    });

                    window.addEventListener('scroll', hidePreview, { passive: true });
                }

                // Initial max-height sync (prevents jumpy filter animations)
                requestAnimationFrame(refreshPublicationHeights);


            };

            const loadPublications = async () => {
                try {
                    const res = await fetch('data/publications.json', { cache: 'no-store' });
                    if (!res.ok) throw new Error(`Failed to load publications.json (${res.status})`);
                    const pubs = await res.json();

                    renderPublications(pubs);

                    if (publicationsLoading) publicationsLoading.classList.add('hidden');
                    if (publicationsContent) publicationsContent.classList.remove('hidden');

                    initPublicationUI();
                } catch (err) {
                    console.error(err);

                    if (publicationsLoading) {
                        publicationsLoading.innerHTML = `
                            <i class="fas fa-triangle-exclamation text-4xl mb-4 text-amber-500"></i>
                            <p class="text-lg font-semibold">Failed to load publications.</p>
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-500">
                                data/publications.json 를 불러오지 못했어요. GitHub Pages 같은 웹서버에서 실행하거나,
                                파일 경로/이름이 맞는지 확인해 주세요.
                            </p>
                        `;
                    }
                }
            };

            loadPublications();
        });
</script>
</body>
</html>
