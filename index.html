<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X9ZS7RK2T7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-X9ZS7RK2T7');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YounginKim</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>    <!-- Google Fonts: Poppins -->
    <script>
    tailwind.config = {
        darkMode: 'class'
    }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom Styles & Animations */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa; /* Default light background */
        }
        
        .dark body {
            background-color: #111827; /* Default dark background */
        }

        :root { --hero-logo-box: 144px; }

        /* Keyframes for the moving gradient background */
        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Hero section with a special animated background */
        #home {
            background-color: #111827;
            background-image: radial-gradient(at 8% 13%, hsla(45, 90%, 60%, 0.38) 0px, transparent 50%),
                              radial-gradient(at 86% 27%, hsla(35, 90%, 65%, 0.35) 0px, transparent 50%),
                              radial-gradient(at 22% 83%, hsla(283,70%,63%,0.35) 0px, transparent 50%);
            background-size: 200% 200%;
            animation: moveGradient 20s ease infinite;
            position: fixed; /* Make it fixed to stay during scroll-fade */
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden; /* Clip ripple effect within viewport */
            z-index: 1; /* Behind the main content */
        }
        
        #home-content-wrapper {
             transition: opacity 0.3s ease-out, transform 0.3s ease-out;
             pointer-events: none; /* let hero background/word field receive interactions */
        }
        #home-content-wrapper a,
        #home-content-wrapper button {
            pointer-events: auto; /* keep buttons/links clickable */
        }

        /* This div pushes the main content down by 100vh */
        #hero-spacer {
            height: 100vh;
        }

        /* Main content wrapper that will scroll over the hero */
        #main-content {
            position: relative;
            z-index: 10; /* In front of the hero section */
        }

        /* Scroll-triggered fade-in animation */
        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom gradient text for hero section */
        .gradient-text {
            background: linear-gradient(90deg, #fde047, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        
        /* Dynamic Abstract Animation */
        .abstract-container {
            max-height: 0;
            opacity: 0;
            transform: translateY(-10px) scaleY(0.98);
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        opacity 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        margin-top 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .abstract-container.show {
            opacity: 1;
            transform: translateY(0) scaleY(1);
            margin-top: 1rem;
        }

        /* Animated Search Bar */
        #search-input {
            width: 0;
            padding-left: 0;
            padding-right: 0;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            outline: none; /* Remove default focus outline */
        }
        #search-bar-container.expanded #search-input {
            width: 280px; /* Expanded width */
            padding-left: 1.25rem;
            padding-right: 3rem; /* Space for the icon */
        }
        #search-bar-container {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        /* Add a soft glow when the search bar is focused */
        #search-bar-container:focus-within {
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.5);
        }

                /* Publication Item Filter Animation */
        .publication-item, .year-section, #no-results-message {
            transition: opacity 0.38s ease,
                        transform 0.38s ease,
                        max-height 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        padding 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        margin 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        border-width 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
            max-height: var(--mh, 1400px); /* JS will keep this synced to content height */
            will-change: max-height, opacity, transform;
        }

        .hidden-filter {
            opacity: 0;
            transform: scale(0.95);
            max-height: 0 !important;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
            border-width: 0 !important;
        }

        /* Tag Color System */
        .tag- { background-color: #6b7280; color: white; }
        .tag-inputdevice { background-color: #f59e0b; color: white; } /* Amber-500 */
        .tag-haptic { background-color: #8b5cf6; color: white; } /* Violet-500 */
        .tag-VRAR { background-color: #10b981; color: white; } /* Emerald-500 */
        .tag-locomotion { background-color: #ff5cce; color: white; } /* Violet-500 */
        .tag-MLDL { background-color: #00bbff; color: white; } /* Emerald-500 */

        .tag-btn {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .dark .tag-btn {
            background-color: #374151;
            color: #d1d5db;
        }
        .tag-btn.active {
            color: white !important;
        }
        .tag-btn.active.tag-all { background-color: #4b5563; }
        .tag-btn.active.tag-inputdevice { background-color: #d97706; } /* Amber-600 */
        .tag-btn.active.tag-haptic { background-color: #7c3aed; } /* Violet-600 */
        .tag-btn.active.tag-VRAR { background-color: #059669; } /* Emerald-600 */
        .tag-btn.active.tag-locomotion { background-color: #943577; } /* Violet-600 */
        .tag-btn.active.tag-MLDL { background-color: #3d95b4; } /* Emerald-600 */ 

        .dark .tag-btn.active.tag-all { background-color: #6b7280; }
        .dark .tag-btn.active.tag-inputdevice { background-color: #f59e0b; }
        .dark .tag-btn.active.tag-haptic { background-color: #8b5cf6; }
        .dark .tag-btn.active.tag-VRAR { background-color: #10b981; }
        .tag-btn.active.tag-locomotion { background-color: #ff5cce; } /* Violet-600 */
        .tag-btn.active.tag-MLDL { background-color: #00bbff; } /* Emerald-600 */

        .publication-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* HERO click ripple effect */
        #hero-ripple-container {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 2; /* Above background, below hero content */
        }
        .hero-ripple {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 9999px;
            left: 0;
            top: 0;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0.9;
            border: 2px solid rgba(255, 255, 255, 0.35);
            box-shadow: 0 0 24px rgba(245, 158, 11, 0.25);
            mix-blend-mode: screen;
            animation: heroRipple 1.25s ease-out forwards;
            will-change: transform, opacity;
        }
        .hero-ripple::after {
            content: "";
            position: absolute;
            inset: -7px;
            border-radius: 9999px;
            border: 1px solid rgba(245, 158, 11, 0.35);
            opacity: 0.75;
        }
        @keyframes heroRipple {
            0%   { transform: translate(-50%, -50%) scale(0); opacity: 0.85; }
            100% { transform: translate(-50%, -50%) scale(var(--ripple-scale, 18)); opacity: 0; }
        }

        /* HERO interactive word field (Human/Computer drag) */
        #hero-wordfield {
            position: absolute;
            inset: 0;
            z-index: 3; /* Above background, below hero content */
            overflow: hidden;
            pointer-events: none; /* allow clicks through except on tokens */
        }
        .hero-token {
            position: absolute;
            left: 0;
            top: 0;
            will-change: transform;
            user-select: none;
            pointer-events: auto;
            cursor: grab;
        }
        .hero-token:active { cursor: grabbing; }

        .hero-token-inner {
            display: inline-block;
            transform: scale(1);
            transition: transform 0.18s ease, opacity 0.18s ease;
            white-space: nowrap;
        }

        .hero-token.word .hero-token-inner {
            font-weight: 700;
            font-size: 22px;
            letter-spacing: 0.4px;
            opacity: 1;
            text-shadow: 0 10px 26px rgba(0,0,0,0.18);
        }
        .hero-token.word.human .hero-token-inner { color: rgba(253, 224, 71, 0.22); }
        .hero-token.word.computer .hero-token-inner { color: rgba(255, 255, 255, 0.20); }

        .hero-token.logo .hero-token-inner {
            width: var(--hero-logo-box, 144px);
            height: var(--hero-logo-box, 144px);
            opacity: 0.99;
            filter: drop-shadow(0 18px 40px rgba(0,0,0,0.25));
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hero-token.logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            pointer-events: none; /* ensure drag works on the visible logo */
        }

        .hero-token.dragging .hero-token-inner {
            transform: scale(1.08);
            opacity: 0.34;
        }
        .hero-token.near .hero-token-inner {
            transform: scale(1.10);
            opacity: 0.38;
            text-shadow: 0 0 30px rgba(245,158,11,0.22);
        }
        .hero-token.logo.pop .hero-token-inner {
            animation: heroTokenPop 380ms cubic-bezier(0.22, 1, 0.36, 1) both;
        }
        @keyframes heroTokenPop {
            0%   { transform: scale(0.55); opacity: 0.0; }
            60%  { transform: scale(1.18); opacity: 1.0; }
            100% { transform: scale(1.0); opacity: 0.72; }
        }


        
        /* Hero screen shake (used when logo + logo merges) */
        @keyframes ykHeroShake {
            0%   { transform: translate3d(0, 0, 0); }
            15%  { transform: translate3d(-6px, 3px, 0); }
            30%  { transform: translate3d(5px, -4px, 0); }
            45%  { transform: translate3d(-4px, -2px, 0); }
            60%  { transform: translate3d(4px, 4px, 0); }
            75%  { transform: translate3d(-3px, 2px, 0); }
            100% { transform: translate3d(0, 0, 0); }
        }
        .hero-shake {
            animation: ykHeroShake 420ms ease-in-out;
        }

/* Research cards hover highlight */
        .research-card {
            border: 1px solid transparent;
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
        }
        .research-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 18px 50px rgba(0, 0, 0, 0.08);
            border-color: rgba(245, 158, 11, 0.55);
        }
        .dark .research-card:hover {
            box-shadow: 0 18px 50px rgba(0, 0, 0, 0.35);
            border-color: rgba(252, 211, 77, 0.28);
        }

        /* News cards hover highlight */
        .news-card {
            border: 1px solid transparent;
            transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease;
        }
        .news-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.08);
            border-color: rgba(245, 158, 11, 0.45);
        }
        .dark .news-card:hover {
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.35);
            border-color: rgba(252, 211, 77, 0.24);
        }

        /* Publication thumbnail */
        .pub-thumb {
            border: 1px solid rgba(229, 231, 235, 0.7); /* gray-200 */
        }
        .dark .pub-thumb {
            border-color: rgba(55, 65, 81, 0.9); /* gray-700 */
        }

    
        /* Publication thumbnail hover preview (0.5s delay) */
        .pub-thumb {
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
        }
        .pub-thumb.preview-active {
            transform: scale(1.03);
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.18);
            border-color: rgba(245, 158, 11, 0.55);
        }
        .dark .pub-thumb.preview-active {
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.42);
            border-color: rgba(252, 211, 77, 0.32);
        }
        #pub-image-preview {
            position: fixed;
            left: 0;
            top: 0;
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px) scale(0.98);
            transition: opacity 0.18s ease, transform 0.18s ease;
        }
        #pub-image-preview.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        #pub-image-preview .preview-box {
            border-radius: 14px;
            overflow: hidden;
            border: 1px solid rgba(245, 158, 11, 0.35);
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.22);
        }
        .dark #pub-image-preview .preview-box {
            background: rgba(17, 24, 39, 0.82);
            border-color: rgba(252, 211, 77, 0.24);
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.45);
        }
        #pub-image-preview img {
            display: block;
            max-width: min(560px, 82vw);
            max-height: min(440px, 72vh);
            object-fit: contain;
        }


        /* ------------------------------------------------------------
           News Timeline (Index Page)
        ------------------------------------------------------------ */
        
.news-timeline {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 0.55rem;
        }
        .news-timeline::before {
            content: "";
            position: absolute;
            left: 0.85rem; /* aligns with marker center */
            top: 0.15rem;
            bottom: 0.15rem;
            width: 1px;
            background: rgba(203, 213, 225, 0.9); /* slate-300-ish */
        }
        .dark .news-timeline::before {
            background: rgba(71, 85, 105, 0.85); /* slate-600-ish */
        }

        /* Each row (clickable) */
        .news-timeline-entry {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.9rem;
            text-decoration: none;
            cursor: pointer;
        }

        .news-timeline-marker {
            position: absolute;
            left: 0.85rem;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 9999px;
            background: #f59e0b; /* amber-500 */
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.92);
        }
        .dark .news-timeline-marker {
            box-shadow: 0 0 0 4px rgba(17, 24, 39, 0.95);
        }

        /* Month label next to the marker (outside the pill) */
        .news-timeline-date {
            font-size: 0.74rem;
            font-weight: 700;
            color: #6b7280; /* gray-500 */
            min-width: 104px;
            padding-left: 1.55rem; /* space for marker */
            letter-spacing: 0.2px;
            white-space: nowrap;
        }
        .dark .news-timeline-date {
            color: #94a3b8; /* slate-400 */
        }

        /* Pill (title only) */
        .news-timeline-item {
            flex: 1 1 auto;
            display: block;
            padding: 0.46rem 0.9rem;
            border-radius: 0.95rem;
            border: 1px solid rgba(226, 232, 240, 0.95);
            background: rgba(255, 255, 255, 0.86);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.045);
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }
        .dark .news-timeline-item {
            border-color: rgba(55, 65, 81, 0.95);
            background: rgba(31, 41, 55, 0.78);
            box-shadow: 0 2px 14px rgba(0, 0, 0, 0.28);
        }

        .news-timeline-entry:hover .news-timeline-item {
            transform: translateY(-1px);
            box-shadow: 0 10px 26px rgba(0, 0, 0, 0.08);
            border-color: rgba(245, 158, 11, 0.45);
        }
        .dark .news-timeline-entry:hover .news-timeline-item {
            box-shadow: 0 14px 32px rgba(0, 0, 0, 0.38);
        }

        .news-timeline-title {
            font-size: 0.88rem; /* slightly smaller */
            font-weight: 600;
            color: #111827;
            line-height: 1.25;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .dark .news-timeline-title { color: #f3f4f6; }

        .news-timeline-entry:hover .news-timeline-title { color: #d97706; } /* amber-600 */
        .dark .news-timeline-entry:hover .news-timeline-title { color: #fcd34d; } /* amber-300 */

        @media (max-width: 420px){
            .news-timeline-date { min-width: 92px; }
        }


        
        /* ------------------------------------------------------------
           News Overlay (SPA-like transition for "View all News")
        ------------------------------------------------------------ */
        #yk-news-overlay {
            position: fixed;
            inset: 0;
            z-index: 40; /* below header (z-50) */
            display: none;
        }
        #yk-news-overlay.active { display: block; }

        /* Slide-in page transition (index ↔ News overlay) */
        #home, #hero-spacer, #main-content {
            transition: transform 560ms cubic-bezier(0.22, 1, 0.36, 1);
            will-change: transform;
        }
        html.yk-news-open #home,
        html.yk-news-open #hero-spacer,
        html.yk-news-open #main-content {
            transform: translate3d(-100%, 0, 0);
        }

        #yk-news-overlay .yk-shell {
            position: absolute;
            inset: 0;
            overflow: hidden;
            background: #111827;
            border-radius: 0;
            box-shadow: none;
            transform: translate3d(100%, 0, 0);
            transition: transform 560ms cubic-bezier(0.22, 1, 0.36, 1);
            will-change: transform;
        }
        html.yk-news-open #yk-news-overlay .yk-shell {
            transform: translate3d(0, 0, 0);
        }

        #yk-news-overlay .yk-scroll {
            position: absolute;
            inset: 0;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }

        #yk-news-overlay .yk-hero {
            background-color: #111827;
            background-image: radial-gradient(at 8% 13%, hsla(45, 90%, 60%, 0.38) 0px, transparent 50%),
                              radial-gradient(at 86% 27%, hsla(35, 90%, 65%, 0.35) 0px, transparent 50%),
                              radial-gradient(at 22% 83%, hsla(283,70%,63%,0.35) 0px, transparent 50%);
            background-size: 200% 200%;
            animation: moveGradient 20s ease infinite;
        }

        #yk-news-overlay .yk-main {
            background: #f8f9fa;
        }
        .dark #yk-news-overlay .yk-main {
            background: #111827;
        }

        #yk-news-overlay .yk-fade {
            opacity: 0;
            transform: translateY(12px);
            transition: opacity 0.35s ease, transform 0.35s ease;
        }
        #yk-news-overlay .yk-fade.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* News post card hover (scoped) */
        #yk-news-overlay .yk-post {
            border: 1px solid transparent;
            transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease;
        }
        #yk-news-overlay .yk-post:hover {
            transform: translateY(-4px);
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.08);
            border-color: rgba(245, 158, 11, 0.45);
        }
        .dark #yk-news-overlay .yk-post:hover {
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.35);
            border-color: rgba(252, 211, 77, 0.24);
        }

/* ------------------------------------------------------------
           Publications View Toggle + Compact Mode
        ------------------------------------------------------------ */
        .pub-view-btn {
            width: 42px;
            height: 42px;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(229, 231, 235, 1);
            background: rgba(255, 255, 255, 0.86);
            color: rgba(75, 85, 99, 1);
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease, background-color 0.18s ease, color 0.18s ease;
            user-select: none;
        }
        .dark .pub-view-btn {
            border-color: rgba(75, 85, 99, 1);
            background: rgba(55, 65, 81, 0.65);
            color: rgba(229, 231, 235, 1);
        }
        .pub-view-btn:hover {
            border-color: rgba(245, 158, 11, 0.55);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.16);
            transform: translateY(-1px);
        }
        .pub-view-btn.active {
            background: rgba(245, 158, 11, 1);
            border-color: rgba(245, 158, 11, 1);
            color: #ffffff;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.16);
            transform: none;
        }
        .dark .pub-view-btn.active {
            background: rgba(245, 158, 11, 0.96);
            border-color: rgba(245, 158, 11, 0.96);
            color: #111827;
        }

        /* link groups inside publication cards */
        .pub-links-compact { display: none !important; }
        .pub-link-text {
            font-size: 0.90rem;
            font-weight: 700;
            text-decoration: underline;
            text-underline-offset: 3px;
            color: #d97706; /* amber-600 */
            opacity: 0.95;
        }
        .pub-link-text:hover { opacity: 1; }
        .dark .pub-link-text { color: #fcd34d; }

        /* Compact view overrides */
        #publications.pub-compact .pub-thumb { display: none !important; }
        #publications.pub-compact .pub-tags-row { display: none !important; }
        #publications.pub-compact .abstract-container { 
            display: none !important;
            max-height: 0 !important;
            opacity: 0 !important;
            margin-top: 0 !important;
        }

        /* Hide year headers + remove inter-item spacing (Tailwind space-y-8) */
        #publications.pub-compact .year-section > h3 {
            display: none !important;
            margin: 0 !important;
            padding: 0 !important;
            border: 0 !important;
        }
        #publications.pub-compact .space-y-8 > :not([hidden]) ~ :not([hidden]) {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }

        /* Make each item a dense, borderless row (no partitions) */
        #publications.pub-compact .publication-item {
            padding: 0.12rem 0 !important;
            background: transparent !important;
            box-shadow: none !important;
            border-width: 0 !important;
            border-radius: 0 !important;
        }
        #publications.pub-compact .pub-top {
            gap: 0.45rem !important;
            flex-direction: row !important;
            flex-wrap: wrap;
            align-items: flex-start;
        }
        #publications.pub-compact .pub-links {
            margin-top: 0 !important;
        }
        #publications.pub-compact .publication-title {
            font-size: 1.05rem !important;
        }
        #publications.pub-compact .pub-authors {
            font-size: 0.90rem !important;
            margin-top: 0.22rem !important;
        }
        #publications.pub-compact .pub-venue {
            font-size: 0.82rem !important;
            margin-top: 0.10rem !important;
        }

        #publications.pub-compact .pub-links-detailed { display: none !important; }
        #publications.pub-compact .pub-links-compact { 
            display: flex !important;
            gap: 0.75rem;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

</style>
    <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        if (localStorage.getItem('color-theme') === 'dark') {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.add('light');
        }
    </script>
</head>
<body class="light">

    <!-- Header & Navigation -->
    <header id="header" class="text-white fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold">YoungIn Kim</a>
            <div class="flex items-center space-x-4">
                <ul class="hidden md:flex items-center space-x-8">
                    <li><a href="#about" class="nav-link font-semibold">About</a></li>
                    <li><a href="#research" class="nav-link font-semibold">Interests</a></li>
                    <li><a href="#news" class="nav-link font-semibold">News</a></li>
                    <li><a href="#publications" class="nav-link font-semibold">Publications</a></li>
                    <li><a href="#contact" class="nav-link font-semibold">Contact</a></li>
                </ul>
                <button id="theme-toggle" type="button" class="text-gray-400 hover:text-white focus:outline-none rounded-lg text-sm p-2.5">
                    <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                </button>
                <button id="mobile-menu-button" class="md:hidden">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm text-gray-900 dark:text-white border-t border-gray-200/70 dark:border-gray-700/70">
             <a href="#about" class="block py-2">About</a>
             <a href="#research" class="block py-2">Interests</a>
             <a href="#news" class="block py-2">News</a>
             <a href="#publications" class="block py-2">Publications</a>
             <a href="#contact" class="block py-2">Contact</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home">
        <div id="hero-ripple-container" aria-hidden="true"></div>
        <div id="hero-wordfield" aria-hidden="true"></div>
        <div id="home-content-wrapper" class="h-full flex flex-col items-center justify-center text-white relative z-10">
            <div class="container mx-auto px-6 text-center flex-grow flex flex-col items-center justify-center">
                <h1 class="text-4xl md:text-6xl font-bold leading-tight mb-4">
                    Researching Devices that
                    <br>
                    <span class="gradient-text"> Make Our Lives Fun</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto">
                    HCI researcher exploring novel devices to enhance user experiences in Desktop, Laptop, VR/AR, and so on.
                </p>
                <a href="#about" class="mt-8 inline-block bg-amber-500 text-white font-bold rounded-lg px-8 py-3 hover:bg-amber-600 transition-all duration-300 shadow-lg hover:shadow-amber-500/50 transform hover:scale-105">
                    Explore My Work
                </a>
            </div>
            <!-- Latest News Floating Box -->
            <a id="hero-latest-news-float" href="#news" class="latest-news-float bg-gray-900/50 hover:bg-gray-900/80 transition-colors w-11/12 md:w-auto max-w-2xl p-4 rounded-xl mb-8">
                <p class="text-sm font-semibold text-gray-200">
                    <span class="font-bold text-amber-300">Latest News:</span>
                    <span id="hero-latest-news-title">Loading...</span>
                </p>
            </a>
        </div>
    </section>

    <!-- This div creates space for the fixed hero section -->
    <div id="hero-spacer"></div>

    <!-- Main Content Wrapper -->
    <div id="main-content" class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-500">
        <main>
            <!-- About Me Section -->
            <section id="about" class="py-20 fade-in-section">
                 <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">About Me</h2>
                        <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    </div>
                    <div class="flex flex-col md:flex-row items-center gap-12">
                        <div class="md:w-1/3 text-center">
                            <img src="images/kyi_profile.png" alt="Young-in's Portrait" class="rounded-full shadow-lg mx-auto w-64 h-64 object-cover">
                        </div>
                        <div class="md:w-2/3">
                            <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
                                Hello, I’m now a Master’s Student in School of Copmuting, KAIST. I am currently part of the 
                                <a href="https://hcil.kaist.ac.kr/" target="_blank" class="text-amber-500 hover:underline"><strong>Human-Computer Interaction Lab (HCIL)</strong></a>, 
                                advised by 
                                <a href="https://cs.kaist.ac.kr/people/view?idx=372&kind=faculty&menu=172" target="_blank" class="text-amber-500 hover:underline"><strong>Prof. Geehyuk Lee</strong></a>.
                            </p>
                            <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
                                I am recently interested in discovering various <strong>Haptic Devices</strong> for VR and AR devices for more immersive and interesting user experiences.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Research Interests Section -->
            <section id="research" class="py-20 bg-white dark:bg-gray-800 fade-in-section">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">Research Interests</h2>
                        <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    </div>
                    <div class="grid md:grid-cols-3 gap-8 text-center">
                        <div class="research-card group p-8 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm">
                            <i class="fas fa-keyboard text-4xl text-amber-500 dark:text-amber-400 mb-4 transition-transform duration-300 group-hover:scale-110"></i>
                            <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Input Devices</h3>
                            <p class="text-gray-600 dark:text-gray-400">Exploring more convenient and useful new input devices.</p>
                        </div>
                        <div class="research-card group p-8 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm">
                            <i class="fas fa-user-gear text-4xl text-amber-500 dark:text-amber-400 mb-4 transition-transform duration-300 group-hover:scale-110"></i>
                            <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Haptics</h3>
                            <p class="text-gray-600 dark:text-gray-400">Providing more diverse and realistic haptic feedback, and exploring human perception models of haptics.</p>
                        </div>
                        <div class="research-card group p-8 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-sm">
                            <i class="fas fa-vr-cardboard text-4xl text-amber-500 dark:text-amber-400 mb-4 transition-transform duration-300 group-hover:scale-110"></i>
                            <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">VR/AR</h3>
                            <p class="text-gray-600 dark:text-gray-400">Making VR/AR/XR environments more immersive and realistic</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- News Section -->
            <section id="news" class="py-20 fade-in-section">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">News</h2>
                        <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    </div>

                    <div class="max-w-3xl mx-auto">
                        <div id="news-loading" class="text-center py-10 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
                            <p class="text-sm font-semibold">Loading news...</p>
                        </div>

                        <div id="news-list" class="news-timeline"></div>

                        <div id="news-empty" class="hidden text-center py-10">
                            <i class="fas fa-newspaper text-3xl text-gray-400 mb-3"></i>
                            <p class="text-gray-500 dark:text-gray-400">No news posts yet.</p>
                        </div>

                        <div class="mt-10 text-center">
                            <a href="news.html" class="inline-flex items-center gap-2 bg-amber-500 text-white font-bold rounded-lg px-6 py-3 hover:bg-amber-600 transition-all duration-300 shadow-lg hover:shadow-amber-500/30 transform hover:scale-105">
                                View all News <i class="fas fa-arrow-right text-sm"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Publications Section -->
            <section id="publications" class="py-20 bg-white dark:bg-gray-800 fade-in-section">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">Publications</h2>
                        <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    </div>

                    <!-- Search and Filter Controls -->
                    <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-12">
                        <!-- Search Bar -->
                        <div id="search-bar-container" class="relative flex items-center bg-white dark:bg-gray-700 rounded-full shadow-sm">
                            <input type="text" id="search-input" placeholder="Search titles..." class="h-12 border-none bg-transparent focus:ring-0 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                            <button id="search-icon" class="absolute right-0 top-0 h-full px-4 text-gray-600 dark:text-gray-300 hover:text-amber-500 dark:hover:text-amber-400 focus:outline-none">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <!-- Tag Filter Buttons -->
                        <div id="tag-filter-container" class="flex justify-center flex-wrap gap-3">
                            <button class="tag-btn active tag-all" data-tag="all">All</button>
                            <button class="tag-btn tag-inputdevice" data-tag="inputdevice">Input Device</button>
                            <button class="tag-btn tag-haptic" data-tag="haptic">Haptic</button>
                            <button class="tag-btn tag-VRAR" data-tag="vrar">VR/AR</button>
                            <button class="tag-btn tag-locomotion" data-tag="locomotion">Locomotion</button>
                            <button class="tag-btn tag-MLDL" data-tag="mldl">MLDL</button>
                        </div>
                        <!-- View Mode Toggle -->
                        <div id="pub-view-toggle" class="flex items-center gap-2">
                            <button id="pub-view-detailed" type="button" class="pub-view-btn active" aria-label="Detailed view" title="Detailed view">
                                <i class="fas fa-table-cells-large"></i>
                            </button>
                            <button id="pub-view-compact" type="button" class="pub-view-btn" aria-label="Compact view" title="Compact view">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>

                    
                    <!-- Publications List (generated from JSON: data/publications.json) -->
                    <div id="publications-loading" class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                        <p class="text-lg">Loading publications...</p>
                        <p class="mt-2 text-sm text-gray-500 dark:text-gray-500">
                            Tip: 로컬에서 file://로 열면 JSON 로딩이 막힐 수 있어요. (GitHub Pages 등) 웹서버로 띄우면 정상 동작합니다.
                        </p>
                    </div>

                    <div id="publications-content" class="space-y-8 hidden">
                        <div id="publications-list" class="space-y-8"></div>

                        <!-- No Results Message -->
                        <div id="no-results-message" class="hidden-filter text-center py-12">
                            <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                            <p class="text-xl text-gray-500 dark:text-gray-400">No publications found matching your criteria.</p>
                        </div>

                    </div>

                </div>
            </section>
            
            <!-- Contact Section -->
            <section id="contact" class="py-20 fade-in-section">
                 <div class="container mx-auto px-6 text-center">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">Get In Touch</h2>
                    <div class="w-24 h-1 bg-amber-500 mx-auto mt-4"></div>
                    <p class="mt-6 text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                        If you have any questions about my research, feel free to reach out.
                    </p>
                    <div class="mt-8 flex justify-center items-center space-x-6 text-2xl">
                        <a href="mailto:youngin@kaist.ac.kr" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors"><i class="fas fa-envelope"></i></a>
                        <a href="https://github.com/youngin3737" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors"><i class="fab fa-github"></i></a>
                        <a href="https://www.linkedin.com/in/youngin-kim-48624a2a2" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors"><i class="fab fa-linkedin"></i></a>
                        <a href="https://scholar.google.com/citations?user=sPl0gUgAAAAJ" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors"><i class="fas fa-graduation-cap"></i></a>
                        <a href="assets/CV.pdf" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 transition-colors" aria-label="CV"><i class="fas fa-file-pdf"></i></a>

                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 dark:bg-black text-white py-6">
            <div class="container mx-auto px-6 text-center">
                <p>&copy; <span id="year"></span> YoungIn Kim. All Rights Reserved.</p>
            </div>
        </footer>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Set current year in footer
            document.getElementById('year').textContent = new Date().getFullYear();

            // Mobile menu toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            const header = document.getElementById('header');
            const homeContentWrapper = document.getElementById('home-content-wrapper');

            // --- SCROLL-BASED ANIMATIONS ---
            window.addEventListener('scroll', () => {
                const scrollY = window.scrollY;
                const viewportHeight = window.innerHeight;

                // 1. Hero Section Fade-out Animation
                const fadeEnd = viewportHeight * 0.8;
                let opacity = 1 - (scrollY / fadeEnd);
                opacity = Math.max(0, Math.min(1, opacity)); // Clamp between 0 and 1

                if (homeContentWrapper) {
                    homeContentWrapper.style.opacity = opacity;
                    homeContentWrapper.style.transform = `scale(${1 - (scrollY / (viewportHeight * 4))})`;
                }

                // 2. Header Style Change
                if (scrollY > 50) {
                    header.classList.add(
                        'bg-white/80', 'dark:bg-gray-900/80',
                        'backdrop-blur-md', 'shadow-sm',
                        'text-gray-800', 'dark:text-gray-200'
                    );
                    header.classList.remove('text-white');
                } else {
                    header.classList.remove(
                        'bg-white/80', 'dark:bg-gray-900/80',
                        'backdrop-blur-md', 'shadow-sm',
                        'text-gray-800', 'dark:text-gray-200'
                    );
                    header.classList.add('text-white');
                }
            });

            // Intersection Observer for fade-in animations for other sections
            const sections = document.querySelectorAll('.fade-in-section');
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            sections.forEach(section => {
                observer.observe(section);
            });

            // Active navigation link highlighting on scroll
            const navLinks = document.querySelectorAll('.nav-link');
            const allSections = document.querySelectorAll('#main-content section');

            const activateNavOnScroll = () => {
                let current = '';
                allSections.forEach(section => {
                    const sectionTop = section.offsetTop + document.getElementById('main-content').offsetTop;
                    if (pageYOffset >= sectionTop - 100) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            };
            window.addEventListener('scroll', activateNavOnScroll);

            // Dark Mode Toggle Script
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
            const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
            const htmlEl = document.documentElement;

            function setTheme(theme) {
                htmlEl.classList.remove('light', 'dark');
                htmlEl.classList.add(theme);
                localStorage.setItem('color-theme', theme);

                if (theme === 'dark') {
                    themeToggleLightIcon.classList.remove('hidden');
                    themeToggleDarkIcon.classList.add('hidden');
                } else {
                    themeToggleDarkIcon.classList.remove('hidden');
                    themeToggleLightIcon.classList.add('hidden');
                }
                window.dispatchEvent(new Event('scroll'));
            }

            if (localStorage.getItem('color-theme') === 'dark') {
                setTheme('dark');
            } else {
                setTheme('light');
            }

            themeToggleBtn.addEventListener('click', () => {
                const currentTheme = htmlEl.classList.contains('dark') ? 'light' : 'dark';
                setTheme(currentTheme);
            });

            
            // --- HERO interactive word field (Human/Computer drag) ---
            const homeSection = document.getElementById('home');
            const wordField = document.getElementById('hero-wordfield');
            const rippleContainer = document.getElementById('hero-ripple-container');

            if (homeSection && wordField) {
                const tokens = [];
                let lastT = performance.now();

                const rand = (a, b) => a + Math.random() * (b - a);
                const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));

                const readCssPx = (varName, fallback) => {
                    try {
                        const v = getComputedStyle(document.documentElement).getPropertyValue(varName);
                        const n = parseFloat(v);
                        return Number.isFinite(n) ? n : fallback;
                    } catch (_) {
                        return fallback;
                    }
                };

                // Keep JS in sync with CSS via :root { --hero-logo-box: ...px; }
                const LOGO_BOX = readCssPx('--hero-logo-box', 144);

                // Physics tuning
                const PHYS = {
                    wordSnapRadius: 78,
                    logoSnapRadius: Math.max(88, LOGO_BOX * 0.65),
                    // How fast released velocity returns to its gentle drift target (bigger = stops faster)
                    returnRate: 3.0, // per-second
                    // Limit fling speed
                    maxFlingWord: 900,
                    maxFlingLogo: 650,
                    // How strongly we keep the release velocity (smaller = gentler)
                    flingScaleWord: 0.75,
                    flingScaleLogo: 0.70
                };

                const bounds = { w: 0, h: 0 };

                const updateBounds = () => {
                    bounds.w = homeSection.clientWidth || window.innerWidth;
                    bounds.h = homeSection.clientHeight || window.innerHeight;
                };

                const calcCount = () => {
                    const w = bounds.w || window.innerWidth;
                    const h = bounds.h || window.innerHeight;
                    const base = Math.round((w * h) / 60000);
                    return clamp(base, 10, 40);
                };

                const updateTransform = (tok) => {
                    tok.el.style.transform = `translate3d(${tok.x}px, ${tok.y}px, 0) rotate(${tok.rot}deg)`;
                };

                // Pointer position in hero-local coordinates (handles accidental parent scaling)
                const toLocalPointer = (e) => {
                    const rect = homeSection.getBoundingClientRect();
                    const baseW = homeSection.clientWidth || rect.width || 1;
                    const baseH = homeSection.clientHeight || rect.height || 1;
                    const sx = rect.width / baseW;
                    const sy = rect.height / baseH;

                    const px = (e.clientX - rect.left) / (sx || 1);
                    const py = (e.clientY - rect.top) / (sy || 1);
                    return { x: px, y: py };
                };

                const safeSpawn = (w, h) => {
                    // Avoid the central text/button area so interaction doesn't interfere
                    const ex = {
                        x1: bounds.w * 0.28,
                        x2: bounds.w * 0.72,
                        y1: bounds.h * 0.22,
                        y2: bounds.h * 0.78
                    };

                    for (let tries = 0; tries < 40; tries++) {
                        const x = rand(0, Math.max(1, bounds.w - w));
                        const y = rand(0, Math.max(1, bounds.h - h));
                        const cx = x + w / 2;
                        const cy = y + h / 2;

                        if (!(cx > ex.x1 && cx < ex.x2 && cy > ex.y1 && cy < ex.y2)) {
                            return { x, y };
                        }
                    }
                    return {
                        x: rand(0, Math.max(1, bounds.w - w)),
                        y: rand(0, Math.max(1, bounds.h - h))
                    };
                };

                const spawnRipple = (x, y, scale = 60) => {
                    if (!rippleContainer) return;
                    const r = document.createElement('div');
                    r.className = 'hero-ripple';
                    r.style.left = `${x}px`;
                    r.style.top = `${y}px`;
                    r.style.setProperty('--ripple-scale', String(scale));
                    rippleContainer.appendChild(r);
                    r.addEventListener('animationend', () => r.remove(), { once: true });
                };

                const shakeScreen = () => {
                    // Shake hero + header so it feels like the whole screen vibrates
                    const homeEl = homeSection;
                    const headerEl = document.getElementById('header');

                    if (homeEl) {
                        homeEl.classList.remove('hero-shake');
                        // Force reflow so repeated shakes retrigger
                        void homeEl.offsetWidth;
                        homeEl.classList.add('hero-shake');
                        setTimeout(() => homeEl.classList.remove('hero-shake'), 460);
                    }
                    if (headerEl) {
                        headerEl.classList.remove('hero-shake');
                        void headerEl.offsetWidth;
                        headerEl.classList.add('hero-shake');
                        setTimeout(() => headerEl.classList.remove('hero-shake'), 460);
                    }
                };

                const createToken = (kind, x, y) => {
                    const el = document.createElement('div');
                    el.className = `hero-token ${kind === 'logo' ? 'logo' : 'word ' + kind}`;
                    el.dataset.kind = kind;

                    const inner = document.createElement('div');
                    inner.className = 'hero-token-inner';

                    if (kind === 'logo') {
                        const img = document.createElement('img');
                        img.src = 'images/logo.png';
                        img.alt = 'logo';
                        img.loading = 'lazy';
                        inner.appendChild(img);
                    } else {
                        inner.textContent = (kind === 'human') ? 'Human' : 'Computer';
                    }

                    el.appendChild(inner);
                    wordField.appendChild(el);

                    const w = el.offsetWidth || (kind === 'logo' ? LOGO_BOX : 72);
                    const h = el.offsetHeight || (kind === 'logo' ? LOGO_BOX : 20);

                    const rot = (kind === 'logo') ? 0 : rand(-10, 10);

                    const driftVx = (kind === 'logo') ? rand(-10, 10) : rand(-18, 18);
                    const driftVy = (kind === 'logo') ? rand(-8, 8) : rand(-12, 12);

                    const tok = {
                        kind,
                        el,
                        inner,
                        x: clamp(x, 0, Math.max(0, bounds.w - w)),
                        y: clamp(y, 0, Math.max(0, bounds.h - h)),
                        w,
                        h,
                        rot,
                        // current velocity
                        vx: driftVx,
                        vy: driftVy,
                        // drift target velocity (we converge back to this after a fling)
                        tvx: driftVx,
                        tvy: driftVy,
                        dragging: false,
                        ox: 0,
                        oy: 0,
                        lockedUntil: 0,
                        dragHist: []
                    };

                    // Ensure it moves (drift) by default
                    if (Math.abs(tok.vx) < 4) tok.vx = (tok.vx < 0 ? -1 : 1) * rand(6, 12);
                    if (Math.abs(tok.vy) < 3) tok.vy = (tok.vy < 0 ? -1 : 1) * rand(4, 9);
                    tok.tvx = tok.vx;
                    tok.tvy = tok.vy;

                    el._ykToken = tok;
                    updateTransform(tok);

                    // Drag handlers
                    el.addEventListener('pointerdown', onPointerDown);

                    return tok;
                };

                const removeToken = (tok) => {
                    const idx = tokens.indexOf(tok);
                    if (idx !== -1) tokens.splice(idx, 1);
                    tok?.el?.remove();
                };

                let active = null;
                let nearTarget = null;

                const clearNear = () => {
                    if (nearTarget?.el) nearTarget.el.classList.remove('near');
                    if (active?.el) active.el.classList.remove('near');
                    nearTarget = null;
                };

                const findNearestToken = (tok, radius) => {
                    const cx = tok.x + tok.w / 2;
                    const cy = tok.y + tok.h / 2;

                    let best = null;
                    let bestD = radius;

                    for (const other of tokens) {
                        if (other === tok) continue;

                        // Interaction rules:
                        // - word interacts with word (human/computer)
                        // - logo interacts with logo
                        if (tok.kind === 'logo') {
                            if (other.kind !== 'logo') continue;
                        } else {
                            if (other.kind === 'logo') continue;
                        }

                        const ocx = other.x + other.w / 2;
                        const ocy = other.y + other.h / 2;
                        const d = Math.hypot(ocx - cx, ocy - cy);

                        if (d < bestD) {
                            bestD = d;
                            best = other;
                        }
                    }
                    return best;
                };

                const recordDragPoint = (tok, px, py, t) => {
                    if (!tok.dragHist) tok.dragHist = [];
                    tok.dragHist.push({ t, px, py });
                    const cutoff = t - 140; // keep ~140ms window
                    while (tok.dragHist.length && tok.dragHist[0].t < cutoff) tok.dragHist.shift();
                    if (tok.dragHist.length > 12) tok.dragHist.shift();
                };

                const getReleaseVelocity = (tok) => {
                    const hist = tok.dragHist || [];
                    if (hist.length < 2) return null;
                    const a = hist[0];
                    const b = hist[hist.length - 1];
                    const dt = (b.t - a.t) / 1000;
                    if (!dt || dt <= 0) return null;
                    return {
                        vx: (b.px - a.px) / dt,
                        vy: (b.py - a.py) / dt
                    };
                };

                function onPointerDown(e) {
                    if (e.pointerType === 'mouse' && e.button !== 0) return;

                    const tok = this._ykToken;
                    if (!tok) return;

                    active = tok;
                    clearNear();

                    tok.dragging = true;
                    tok.el.classList.add('dragging');
                    tok.el.style.zIndex = '20';

                    const p = toLocalPointer(e);
                    tok.ox = p.x - tok.x;
                    tok.oy = p.y - tok.y;

                    tok.dragHist = [];
                    recordDragPoint(tok, p.x, p.y, performance.now());

                    tok.el.setPointerCapture(e.pointerId);

                    tok.el.addEventListener('pointermove', onPointerMove);
                    tok.el.addEventListener('pointerup', onPointerUp);
                    tok.el.addEventListener('pointercancel', onPointerUp);
                }

                function onPointerMove(e) {
                    const tok = this._ykToken;
                    if (!tok || !tok.dragging) return;

                    const p = toLocalPointer(e);

                    tok.x = clamp(p.x - tok.ox, 0, Math.max(0, bounds.w - tok.w));
                    tok.y = clamp(p.y - tok.oy, 0, Math.max(0, bounds.h - tok.h));
                    updateTransform(tok);

                    recordDragPoint(tok, p.x, p.y, performance.now());

                    const snapR = (tok.kind === 'logo') ? PHYS.logoSnapRadius : PHYS.wordSnapRadius;
                    const candidate = findNearestToken(tok, snapR);
                    if (candidate !== nearTarget) {
                        clearNear();
                        nearTarget = candidate;
                        if (nearTarget) {
                            nearTarget.el.classList.add('near');
                            tok.el.classList.add('near');
                        }
                    }
                }

                const mergeToLogo = (a, b) => {
                    const ax = a.x + a.w / 2, ay = a.y + a.h / 2;
                    const bx = b.x + b.w / 2, by = b.y + b.h / 2;
                    const mx = (ax + bx) / 2;
                    const my = (ay + by) / 2;

                    removeToken(a);
                    removeToken(b);

                    const half = LOGO_BOX / 2;
                    const logoX = clamp(mx - half, 0, Math.max(0, bounds.w - LOGO_BOX));
                    const logoY = clamp(my - half, 0, Math.max(0, bounds.h - LOGO_BOX));

                    const logoTok = createToken('logo', logoX, logoY);
                    tokens.push(logoTok);

                    logoTok.el.classList.add('pop');
                    setTimeout(() => logoTok.el.classList.remove('pop'), 480);

                    // A bit calmer drift for logos
                    logoTok.vx *= 0.55;
                    logoTok.vy *= 0.55;
                    logoTok.tvx = logoTok.vx;
                    logoTok.tvy = logoTok.vy;
                };

                const spawnWordPair = () => {
                    const approxH = 26;
                    const posH = safeSpawn(78, approxH);
                    const tokH = createToken('human', posH.x, posH.y);
                    tokens.push(tokH);

                    const posC = safeSpawn(98, approxH);
                    const tokC = createToken('computer', posC.x, posC.y);
                    tokens.push(tokC);
                };

                const fuseLogos = (a, b) => {
                    const ax = a.x + a.w / 2, ay = a.y + a.h / 2;
                    const bx = b.x + b.w / 2, by = b.y + b.h / 2;
                    const mx = (ax + bx) / 2;
                    const my = (ay + by) / 2;

                    removeToken(a);
                    removeToken(b);

                    // Big ripple + shake
                    const diag = Math.hypot(bounds.w, bounds.h) || 1200;
                    const big = Math.max(38, Math.min(120, diag / 16));
                    const mid = Math.max(22, Math.min(80, diag / 28));
                    spawnRipple(mx, my, big);
                    spawnRipple(mx, my, mid);
                    shakeScreen();

                    

                    // When two logos meet: both disappear (no logo remains)

                    // (keeps the field from getting saturated with logos)
// Spawn 2 Human + 2 Computer at random positions
                    spawnWordPair();
                    spawnWordPair();
                };

                const repelPair = (a, b) => {
                    const acx = a.x + a.w / 2, acy = a.y + a.h / 2;
                    const bcx = b.x + b.w / 2, bcy = b.y + b.h / 2;

                    let dx = acx - bcx;
                    let dy = acy - bcy;

                    const dist = Math.hypot(dx, dy) || 1;
                    dx /= dist;
                    dy /= dist;

                    const push = 90;
                    const newAX = clamp(a.x + dx * push, 0, Math.max(0, bounds.w - a.w));
                    const newAY = clamp(a.y + dy * push, 0, Math.max(0, bounds.h - a.h));
                    const newBX = clamp(b.x - dx * push, 0, Math.max(0, bounds.w - b.w));
                    const newBY = clamp(b.y - dy * push, 0, Math.max(0, bounds.h - b.h));

                    const now = performance.now();
                    a.lockedUntil = now + 260;
                    b.lockedUntil = now + 260;

                    const oldA = a.el.style.transform;
                    const oldB = b.el.style.transform;

                    a.x = newAX; a.y = newAY;
                    b.x = newBX; b.y = newBY;

                    const newAT = `translate3d(${a.x}px, ${a.y}px, 0) rotate(${a.rot}deg)`;
                    const newBT = `translate3d(${b.x}px, ${b.y}px, 0) rotate(${b.rot}deg)`;

                    a.el.animate([{ transform: oldA }, { transform: newAT }], {
                        duration: 260,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    });
                    b.el.animate([{ transform: oldB }, { transform: newBT }], {
                        duration: 260,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    });

                    a.el.style.transform = newAT;
                    b.el.style.transform = newBT;

                    // kick their drift away
                    a.vx = dx * rand(10, 18);
                    a.vy = dy * rand(6, 12);
                    b.vx = -dx * rand(10, 18);
                    b.vy = -dy * rand(6, 12);

                    // update their drift targets too, so they don't immediately drift back into each other
                    a.tvx = a.vx * 0.6;
                    a.tvy = a.vy * 0.6;
                    b.tvx = b.vx * 0.6;
                    b.tvy = b.vy * 0.6;
                };

                function onPointerUp(e) {
                    const tok = this._ykToken;
                    if (!tok) return;

                    tok.dragging = false;
                    tok.el.classList.remove('dragging');
                    tok.el.style.zIndex = '';

                    tok.el.removeEventListener('pointermove', onPointerMove);
                    tok.el.removeEventListener('pointerup', onPointerUp);
                    tok.el.removeEventListener('pointercancel', onPointerUp);

                    const snapR = (tok.kind === 'logo') ? PHYS.logoSnapRadius : PHYS.wordSnapRadius;
                    const candidate = findNearestToken(tok, snapR);
                    clearNear();

                    if (candidate) {
                        if (tok.kind === 'logo' && candidate.kind === 'logo') {
                            // Logo + Logo => ripple + shake + spawn words
                            fuseLogos(tok, candidate);
                            active = null;
                            return;
                        }

                        // Word + Word behavior
                        if (tok.kind !== candidate.kind) {
                            // Human + Computer => logo!
                            mergeToLogo(tok, candidate);
                            active = null;
                            return;
                        } else {
                            // Same type => repel
                            repelPair(tok, candidate);
                            active = null;
                            return;
                        }
                    }

                    // No merge/repel: apply fling inertia
                    const v = getReleaseVelocity(tok);
                    if (v) {
                        const max = (tok.kind === 'logo') ? PHYS.maxFlingLogo : PHYS.maxFlingWord;
                        const scale = (tok.kind === 'logo') ? PHYS.flingScaleLogo : PHYS.flingScaleWord;
                        tok.vx = clamp(v.vx * scale, -max, max);
                        tok.vy = clamp(v.vy * scale, -max, max);
                    }

                    // If release velocity is tiny, keep gentle drift
                    if (Math.abs(tok.vx) < 6) tok.vx = tok.tvx;
                    if (Math.abs(tok.vy) < 5) tok.vy = tok.tvy;

                    active = null;
                }

                const step = (t) => {
                    const dt = Math.min(0.033, (t - lastT) / 1000);
                    lastT = t;

                    const blend = 1 - Math.exp(-dt * PHYS.returnRate);

                    for (const tok of tokens) {
                        if (tok.dragging) continue;
                        if (t < tok.lockedUntil) continue;

                        tok.x += tok.vx * dt;
                        tok.y += tok.vy * dt;

                        // bounce (also flip drift targets so they keep floating inside bounds)
                        if (tok.x < 0) { tok.x = 0; tok.vx = Math.abs(tok.vx); tok.tvx = Math.abs(tok.tvx); }
                        if (tok.y < 0) { tok.y = 0; tok.vy = Math.abs(tok.vy); tok.tvy = Math.abs(tok.tvy); }
                        if (tok.x > bounds.w - tok.w) { tok.x = bounds.w - tok.w; tok.vx = -Math.abs(tok.vx); tok.tvx = -Math.abs(tok.tvx); }
                        if (tok.y > bounds.h - tok.h) { tok.y = bounds.h - tok.h; tok.vy = -Math.abs(tok.vy); tok.tvy = -Math.abs(tok.tvy); }

                        // Smoothly return to drift target (makes fast drags glide then calm down)
                        tok.vx += (tok.tvx - tok.vx) * blend;
                        tok.vy += (tok.tvy - tok.vy) * blend;

                        updateTransform(tok);
                    }
                    requestAnimationFrame(step);
                };

                // Init
                updateBounds();

                const N = calcCount();
                for (let i = 0; i < N; i++) {
                    const kind = (i % 2 === 0) ? 'human' : 'computer';
                    const approxW = (kind === 'human') ? 78 : 98;
                    const approxH = 26;
                    const pos = safeSpawn(approxW, approxH);
                    const tok = createToken(kind, pos.x, pos.y);
                    tokens.push(tok);
                }

                window.addEventListener('resize', () => {
                    updateBounds();
                    for (const tok of tokens) {
                        tok.x = clamp(tok.x, 0, Math.max(0, bounds.w - tok.w));
                        tok.y = clamp(tok.y, 0, Math.max(0, bounds.h - tok.h));
                        updateTransform(tok);
                    }
                });

                requestAnimationFrame(step);
            }


            // --- Publications: load + render from JSON (data/publications.json) ---
            const publicationsLoading = document.getElementById('publications-loading');
            const publicationsContent = document.getElementById('publications-content');
            const publicationsList = document.getElementById('publications-list');

            const TAG_META = {
                inputdevice: { label: 'Input Device', cls: 'tag-inputdevice' },
                haptic: { label: 'Haptic', cls: 'tag-haptic' },
                vrar: { label: 'VR/AR', cls: 'tag-VRAR' },
                locomotion: { label: 'Locomotion', cls: 'tag-locomotion' },
                mldl: { label: 'ML/DL', cls: 'tag-MLDL' }
            };

            const escapeHtml = (unsafe = '') => {
                return String(unsafe)
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            };


            // --- News: load preview (top 5) from JSON (data/news.json) ---
            const newsLoading = document.getElementById('news-loading');
            const newsList = document.getElementById('news-list');
            const newsEmpty = document.getElementById('news-empty');

            
            const heroLatestNewsFloat = document.getElementById('hero-latest-news-float');
            const heroLatestNewsTitle = document.getElementById('hero-latest-news-title');
const formatNewsDate = (iso = '') => {
                const d = new Date(iso);
                if (Number.isNaN(d.getTime())) return iso;
                return d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            };

            const formatNewsMonthYear = (iso = '') => {
                const d = new Date(iso);
                if (Number.isNaN(d.getTime())) return iso;
                return d.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            };

            const buildNewsPreviewItem = (n) => {
                const id = n?.id ? String(n.id) : '';
                const title = n?.title ? String(n.title) : '';
                const dateIso = n?.date ? String(n.date) : '';
                const monthYear = formatNewsMonthYear(dateIso);

                return `
                    <a href="news.html#post-${escapeHtml(id)}" class="news-timeline-entry group" aria-label="${escapeHtml(title)} (${escapeHtml(formatNewsDate(dateIso))})">
                        <span class="news-timeline-marker" aria-hidden="true"></span>
                        <span class="news-timeline-date">${escapeHtml(monthYear)}</span>
                        <span class="news-timeline-item">
                            <span class="news-timeline-title">${escapeHtml(title)}</span>
                        </span>
                    </a>
                `;
            };

            const loadNewsPreview = async () => {
                if (!newsList) return;
                try {
                    const res = await fetch('data/news.json', { cache: 'no-store' });
                    if (!res.ok) throw new Error(`Failed to load news.json (${res.status})`);
                    const news = await res.json();

                    const sorted = (news || []).slice().sort((a,b) => new Date(b.date) - new Date(a.date));
                    window.__yk_news_cache = sorted;
                    const top = sorted.slice(0, 5);

                    

                    // Update hero Latest News (title only)
                    const latest = sorted[0];
                    if (heroLatestNewsFloat) {
                        if (!latest || !latest.title) {
                            heroLatestNewsFloat.classList.add('hidden');
                        } else {
                            heroLatestNewsFloat.classList.remove('hidden');
                            if (heroLatestNewsTitle) heroLatestNewsTitle.textContent = String(latest.title);
                            heroLatestNewsFloat.setAttribute('aria-label', `Latest News: ${String(latest.title)}`);
                        }
                    }
if (top.length === 0) {
                        if (newsLoading) newsLoading.classList.add('hidden');
                        if (newsEmpty) newsEmpty.classList.remove('hidden');
                        if (heroLatestNewsFloat) heroLatestNewsFloat.classList.add('hidden');
                        return;
                    }

                    newsList.innerHTML = top.map(buildNewsPreviewItem).join('\n');
                    if (newsLoading) newsLoading.classList.add('hidden');
                } catch (err) {
                    console.error(err);
                    if (heroLatestNewsFloat) heroLatestNewsFloat.classList.add('hidden');
                    if (newsLoading) {
                        newsLoading.innerHTML = `
                            <i class="fas fa-triangle-exclamation text-3xl mb-3 text-amber-500"></i>
                            <p class="text-sm font-semibold">Failed to load news.</p>
                            <p class="mt-2 text-xs text-gray-500 dark:text-gray-500">
                                data/news.json 를 불러오지 못했어요. 웹서버에서 실행하거나 파일 경로/이름을 확인해 주세요.
                            </p>
                        `;
                    }
                }
            };

            loadNewsPreview();
            // --- News Overlay: "news.html" feel without full reload (keeps header) ---
            let ykNewsOverlayOpen = false;
            let ykNewsOverlayEl = null;
            let ykNewsShellEl = null;
            let ykNewsScrollEl = null;
            let ykNewsPostsEl = null;
            let ykNewsLoadingEl = null;
            let ykNewsEmptyEl = null;
            let ykNewsStartTransform = null;
            let ykNewsStartRadius = '18px';
            let ykNewsLastFocus = null;

            const isPlainLeftClick = (e) => (
                e.button === 0 &&
                !e.metaKey && !e.ctrlKey && !e.shiftKey && !e.altKey
            );

            const lockPageScroll = (lock) => {
                // Prevent background scroll while overlay is open
                if (lock) {
                    document.documentElement.dataset.ykScrollLock = '1';
                    document.documentElement.style.overflow = 'hidden';
                } else {
                    delete document.documentElement.dataset.ykScrollLock;
                    document.documentElement.style.overflow = '';
                }
            };

            const ensureNewsOverlay = () => {
                if (ykNewsOverlayEl) return;

                const overlay = document.createElement('div');
                overlay.id = 'yk-news-overlay';
                overlay.setAttribute('aria-hidden', 'true');

                overlay.innerHTML = `
                    <div class="yk-shell">
                        <div class="yk-scroll">
                            <section class="yk-hero pt-28 pb-14 text-white">
                                <div class="container mx-auto px-6 yk-fade">
                                    <div class="max-w-4xl">
                                        <p class="text-sm text-gray-200/80">YoungIn Kim</p>
                                        <h1 class="mt-2 text-4xl md:text-6xl font-bold leading-tight">
                                            <span class="gradient-text">News</span>
                                        </h1>
                                        <p class="mt-4 text-lg md:text-xl text-gray-200/90">
                                            Updates on publications, talks, reviews, and research milestones.
                                        </p>
                                        <div class="mt-8 flex flex-wrap gap-3">
                                            <button id="yk-news-overlay-back" class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white font-semibold rounded-lg px-5 py-2.5 transition-colors">
                                                <i class="fas fa-arrow-left"></i> Back to Main
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <main class="yk-main text-gray-800 dark:text-gray-200 transition-colors duration-500">
                                <section class="py-16">
                                    <div class="container mx-auto px-6 yk-fade">
                                        <div class="max-w-4xl mx-auto space-y-8">
                                            <div id="yk-news-overlay-loading" class="text-center py-10 text-gray-500 dark:text-gray-400">
                                                <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                                                <p class="text-lg">Loading news...</p>
                                                <p class="mt-2 text-sm text-gray-500 dark:text-gray-500">
                                                    Tip: 로컬에서 file://로 열면 JSON 로딩이 막힐 수 있어요. 웹서버로 띄우면 정상 동작합니다.
                                                </p>
                                            </div>

                                            <div id="yk-news-overlay-posts" class="space-y-8 hidden"></div>

                                            <div id="yk-news-overlay-empty" class="hidden text-center py-12">
                                                <i class="fas fa-newspaper text-4xl text-gray-400 mb-4"></i>
                                                <p class="text-xl text-gray-500 dark:text-gray-400">No news posts yet.</p>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </main>
                        </div>
                    </div>
                `;

                document.body.appendChild(overlay);

                ykNewsOverlayEl = overlay;
                ykNewsShellEl = overlay.querySelector('.yk-shell');
                ykNewsScrollEl = overlay.querySelector('.yk-scroll');
                ykNewsPostsEl = overlay.querySelector('#yk-news-overlay-posts');
                ykNewsLoadingEl = overlay.querySelector('#yk-news-overlay-loading');
                ykNewsEmptyEl = overlay.querySelector('#yk-news-overlay-empty');

                const backBtn = overlay.querySelector('#yk-news-overlay-back');
                if (backBtn) {
                    backBtn.addEventListener('click', () => {
                        // Let popstate drive the close animation
                        history.back();
                    });
                }

                // ESC closes (via history)
                window.addEventListener('keydown', (ev) => {
                    if (!ykNewsOverlayOpen) return;
                    if (ev.key === 'Escape') history.back();
                });
            };

            const formatOverlayDate = (iso = '') => {
                const d = new Date(iso);
                if (Number.isNaN(d.getTime())) return iso;
                return d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            };

            const buildOverlayBadges = (tags = []) => {
                if (!Array.isArray(tags) || tags.length === 0) return '';
                return tags.map((t, i) => {
                    const cls = (i === 0)
                        ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300'
                        : 'bg-gray-100 text-gray-700 dark:bg-gray-700/60 dark:text-gray-300';
                    return `<span class="px-3 py-1 rounded-full text-xs font-semibold ${cls}">${escapeHtml(t)}</span>`;
                }).join('\n');
            };

            const buildOverlayPost = (p) => {
                const id = p?.id ? String(p.id) : '';
                const title = p?.title ? String(p.title) : '';
                const dateIso = p?.date ? String(p.date) : '';
                const thumb = p?.thumbnail ? String(p.thumbnail) : '';
                const icon = p?.icon ? String(p.icon) : 'fa-newspaper';
                const tags = Array.isArray(p?.tags) ? p.tags : [];
                const bodyRaw = p?.body ? String(p.body) : '';
                const bodyHtml = bodyRaw.includes('<') ? bodyRaw : escapeHtml(bodyRaw).replace(/\n/g, '<br>');

                return `
                    <article id="post-${escapeHtml(id)}" class="yk-post bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm scroll-mt-28">
                        <div class="flex flex-col md:flex-row gap-6 items-start">
                            <div class="relative w-full md:w-56 h-44 rounded-lg overflow-hidden flex-shrink-0 bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                                <i class="fas ${escapeHtml(icon)} text-gray-400 dark:text-gray-500 text-3xl absolute"></i>
                                ${thumb ? `<img src="${escapeHtml(thumb)}" alt="${escapeHtml(title)} thumbnail" class="w-full h-full object-cover relative z-10" loading="lazy" onerror="this.style.display='none';">` : ''}
                            </div>
                            <div class="flex-grow">
                                <p class="text-sm text-gray-500 dark:text-gray-400">${escapeHtml(formatOverlayDate(dateIso))}</p>
                                <h2 class="mt-1 text-2xl font-bold text-gray-900 dark:text-white">${escapeHtml(title)}</h2>
                                <div class="mt-4 text-gray-700 dark:text-gray-300 leading-relaxed">
                                    ${bodyHtml}
                                </div>
                                <div class="mt-4 flex flex-wrap gap-2">
                                    ${buildOverlayBadges(tags)}
                                </div>
                            </div>
                        </div>
                    </article>
                `;
            };

            const loadAllNewsData = async () => {
                // Prefer cache from the preview loader
                if (Array.isArray(window.__yk_news_cache)) return window.__yk_news_cache;

                const res = await fetch('data/news.json', { cache: 'no-store' });
                if (!res.ok) throw new Error(`Failed to load news.json (${res.status})`);
                const news = await res.json();
                return (news || []).slice().sort((a,b) => new Date(b.date) - new Date(a.date));
            };

                        const waitForTransformTransition = (el, timeout = 650) => {
                return new Promise((resolve) => {
                    if (!el) return resolve();
                    let done = false;
                    const finish = () => {
                        if (done) return;
                        done = true;
                        el.removeEventListener('transitionend', onEnd);
                        resolve();
                    };
                    const onEnd = (ev) => {
                        if (!ev || ev.target !== el) return;
                        if (ev.propertyName !== 'transform') return;
                        finish();
                    };
                    el.addEventListener('transitionend', onEnd);
                    setTimeout(finish, timeout);
                });
            };

            const openNewsOverlay = async (url = 'news.html', anchorId = null, pushState = true) => {
                if (ykNewsOverlayOpen) return;
                ensureNewsOverlay();

                ykNewsLastFocus = document.activeElement;

                // Prepare overlay (shell starts off-screen to the right via CSS)
                ykNewsOverlayEl.classList.add('active');
                ykNewsOverlayEl.setAttribute('aria-hidden', 'false');

                // Ensure starting state is "closed" before we flip the class on next frame
                document.documentElement.classList.remove('yk-news-open');

                lockPageScroll(true);

                // Reset view + loader
                if (ykNewsScrollEl) ykNewsScrollEl.scrollTop = 0;
                if (ykNewsPostsEl) { ykNewsPostsEl.classList.add('hidden'); ykNewsPostsEl.innerHTML = ''; }
                if (ykNewsLoadingEl) ykNewsLoadingEl.classList.remove('hidden');
                if (ykNewsEmptyEl) ykNewsEmptyEl.classList.add('hidden');

                ykNewsOverlayOpen = true;

                // Push state (URL looks like news.html)
                if (pushState) {
                    const nextUrl = anchorId ? `${url}#${anchorId}` : url;
                    history.pushState({ ykOverlay: 'news', anchor: anchorId || '' }, '', nextUrl);
                }

                // Kick slide animation next frame (page slides left, news slides in from right)
                requestAnimationFrame(() => {
                    document.documentElement.classList.add('yk-news-open');
                });

                // Load data while animation runs
                const dataPromise = loadAllNewsData();

                // Wait for slide-in to settle before revealing inner blocks
                await waitForTransformTransition(ykNewsShellEl, 680);

                // Fade in hero + main blocks
                ykNewsOverlayEl.querySelectorAll('.yk-fade').forEach((el, idx) => {
                    setTimeout(() => el.classList.add('show'), 40 + idx * 70);
                });

                // Render posts
                try {
                    const sorted = await dataPromise;

                    if (!sorted || sorted.length === 0) {
                        if (ykNewsLoadingEl) ykNewsLoadingEl.classList.add('hidden');
                        if (ykNewsEmptyEl) ykNewsEmptyEl.classList.remove('hidden');
                        return;
                    }

                    if (ykNewsPostsEl) {
                        ykNewsPostsEl.innerHTML = sorted.map(buildOverlayPost).join('
');
                        if (ykNewsLoadingEl) ykNewsLoadingEl.classList.add('hidden');
                        ykNewsPostsEl.classList.remove('hidden');
                    }

                    // Scroll to anchor (if provided)
                    if (anchorId) {
                        requestAnimationFrame(() => {
                            const target = ykNewsOverlayEl?.querySelector(`#${CSS.escape(anchorId)}`);
                            if (target && ykNewsScrollEl) {
                                const tr = target.getBoundingClientRect();
                                const cr = ykNewsScrollEl.getBoundingClientRect();
                                const top = tr.top - cr.top;
                                ykNewsScrollEl.scrollTo({ top: Math.max(0, ykNewsScrollEl.scrollTop + top - 110), behavior: 'smooth' });
                            }
                        });
                    }
                } catch (err) {
                    console.error(err);
                    if (ykNewsLoadingEl) {
                        ykNewsLoadingEl.innerHTML = `
                            <i class="fas fa-triangle-exclamation text-4xl mb-4 text-amber-500"></i>
                            <p class="text-lg font-semibold">Failed to load news.</p>
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-500">
                                data/news.json 를 불러오지 못했어요. 웹서버 환경에서 실행하거나, 파일 경로/이름이 맞는지 확인해 주세요.
                            </p>
                        `;
                    }
                }
            };

                        const closeNewsOverlay = async () => {
                if (!ykNewsOverlayOpen || !ykNewsOverlayEl) return;

                // Hide inner fade blocks quickly (so slide-out feels clean)
                ykNewsOverlayEl.querySelectorAll('.yk-fade').forEach(el => el.classList.remove('show'));

                // Slide back (news to right, main page from left)
                document.documentElement.classList.remove('yk-news-open');

                await waitForTransformTransition(ykNewsShellEl, 680);

                ykNewsOverlayEl.classList.remove('active');
                ykNewsOverlayEl.setAttribute('aria-hidden', 'true');
                ykNewsOverlayOpen = false;

                lockPageScroll(false);

                // Restore focus
                if (ykNewsLastFocus && typeof ykNewsLastFocus.focus === 'function') {
                    ykNewsLastFocus.focus();
                }
            };

                        // Intercept in-page navigation to news.html for SPA-like feel
            document.addEventListener('click', (e) => {
                if (!isPlainLeftClick(e)) return;

                const a = e.target?.closest?.('a');
                if (!a) return;

                const href = a.getAttribute('href') || '';
                if (!href) return;

                // While News overlay is open: header/nav anchors should go to the main page (and NOT bounce back to News)
                if (ykNewsOverlayOpen && a.closest('#header')) {
                    const isHashOnly = href.startsWith('#');
                    const isIndexAnchor = href.startsWith('index.html#') || href.startsWith('./index.html#');
                    const isIndexRoot = (href === 'index.html' || href === './index.html');

                    if (isHashOnly || isIndexAnchor || isIndexRoot) {
                        e.preventDefault();

                        const hashPart = href.includes('#') ? href.split('#')[1] : '';
                        const targetId = (hashPart && hashPart !== '#') ? hashPart : '';

                        const targetUrl = targetId ? `index.html#${targetId}` : 'index.html';

                        // Replace the current "news.html" history entry so back won't return to News overlay
                        try { history.replaceState(null, '', targetUrl); } catch (_) {}

                        closeNewsOverlay().then(() => {
                            if (targetId) {
                                const el = document.getElementById(targetId);
                                if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            } else {
                                window.scrollTo({ top: 0, behavior: 'smooth' });
                            }
                        });
                        return;
                    }
                }

                // Open the overlay for news.html links
                if (!href.startsWith('news.html')) return;
                if (a.target === '_blank') return;

                // Respect downloads / external modifiers
                if (a.hasAttribute('download')) return;

                e.preventDefault();

                const hash = href.includes('#') ? href.split('#')[1] : '';
                openNewsOverlay('news.html', hash || null, true);
            });;

            // Popstate: close/open overlay with browser back/forward
            window.addEventListener('popstate', () => {
                const st = history.state;
                const wantNews = st && st.ykOverlay === 'news';

                if (wantNews && !ykNewsOverlayOpen) {
                    const anchor = (st && st.anchor) ? String(st.anchor) : (location.hash ? location.hash.slice(1) : null);
                    openNewsOverlay('news.html', anchor || null, false);
                    return;
                }

                if (!wantNews && ykNewsOverlayOpen) {
                    closeNewsOverlay();
                }
            });

            const buildTagSpans = (tags = []) => {
                return (tags || [])
                    .map(t => {
                        const meta = TAG_META[t];
                        if (!meta) return '';
                        return `<span class="publication-tag ${meta.cls}">${meta.label}</span>`;
                    })
                    .join('\n');
            };

            const buildLinkButtons = (pub) => {
                const detailed = [];
                const compact = [];

                const pushLink = (label, href, detailedClass) => {
                    if (!href) return;
                    detailed.push(`<a href="${escapeHtml(href)}" class="${detailedClass}">${label}</a>`);
                    compact.push(`<a href="${escapeHtml(href)}" class="pub-link-text">${label}</a>`);
                };

                pushLink('DOI', pub.doi, 'bg-amber-500 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-amber-600 transition-colors');
                pushLink('Paper', pub.paper, 'bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-gray-800 transition-colors');
                pushLink('Project', pub.project, 'bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors');

                if (detailed.length === 0) return '';

                return `
                    <div class="pub-links-detailed flex flex-wrap gap-2 justify-start md:justify-end">
                        ${detailed.join('')}
                    </div>
                    <div class="pub-links-compact flex flex-wrap gap-3 justify-start md:justify-end">
                        ${compact.join('')}
                    </div>
                `;
            };

            const buildPublicationItem = (pub) => {
                const tags = Array.isArray(pub.tags) ? pub.tags : [];
                const dataTags = tags.join(' ');
                const thumb = pub.thumbnail ? `
                    <img src="${escapeHtml(pub.thumbnail)}" alt="${escapeHtml(pub.title)} thumbnail" class="w-full h-full object-cover relative z-10" loading="lazy" onerror="this.style.display='none';">
                ` : '';

                const abstractBtn = pub.abstract ? `
                    <button class="abstract-toggle-btn ml-auto bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-300 px-3 py-1 rounded-full text-sm font-semibold hover:bg-amber-200 dark:hover:bg-amber-900">
                        See Abstract
                    </button>
                ` : '';

                const abstractBlock = pub.abstract ? `
                    <div class="abstract-container">
                        <div class="p-4 mt-4 bg-gray-100 dark:bg-gray-700/50 rounded-lg border-l-4 border-amber-400">
                            <p class="abstract-content text-gray-700 dark:text-gray-300 leading-relaxed">
                                ${escapeHtml(pub.abstract)}
                            </p>
                        </div>
                    </div>
                ` : '';

                return `
                    <div class="publication-item bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm flex-col" data-tags="${escapeHtml(dataTags)}">
                        <div class="pub-top flex flex-col md:flex-row items-start gap-6">
                            <div class="pub-thumb relative w-full md:w-40 h-40 md:h-28 rounded-lg overflow-hidden flex-shrink-0 bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                                <i class="fas fa-book-open text-gray-400 dark:text-gray-500 text-3xl absolute"></i>
                                ${thumb}
                            </div>
                            <div class="pub-meta flex-grow min-w-0">
                                <h4 class="publication-title text-xl font-bold text-gray-900 dark:text-white">${escapeHtml(pub.title)}</h4>
                                <p class="pub-authors text-gray-700 dark:text-gray-300 mt-1">${pub.authors || ''}</p>
                                <p class="pub-venue text-gray-500 dark:text-gray-400 italic mt-1">${escapeHtml(pub.venue || '')}</p>
                            </div>
                            <div class="pub-links flex-shrink-0 mt-4 md:mt-0">
                                ${buildLinkButtons(pub)}
                            </div>
                        </div>
                        <div class="pub-tags-row mt-4 flex flex-wrap gap-2 items-center">
                            ${buildTagSpans(tags)}
                            ${abstractBtn}
                        </div>
                        ${abstractBlock}
                    </div>
                `;
            };

            const renderPublications = (pubs) => {
                if (!publicationsList) return;

                // Group by year
                const byYear = {};
                (pubs || []).forEach(pub => {
                    const year = String(pub.year || 'Misc');
                    byYear[year] = byYear[year] || [];
                    byYear[year].push(pub);
                });

                const years = Object.keys(byYear)
                    .filter(y => y !== 'Misc')
                    .sort((a, b) => Number(b) - Number(a));

                if (byYear['Misc']) years.push('Misc');

                const yearBlocks = years.map(year => {
                    const items = byYear[year] || [];
                    const itemsHtml = items.map(buildPublicationItem).join('\n');

                    return `
                        <div class="year-section" data-year="${escapeHtml(year)}">
                            <h3 class="text-2xl font-bold mb-6 text-gray-700 dark:text-gray-300 border-b-2 border-gray-200 dark:border-gray-700 pb-2">${escapeHtml(year)}</h3>
                            <div class="space-y-8">
                                ${itemsHtml}
                            </div>
                        </div>
                    `;
                }).join('\n');

                publicationsList.innerHTML = yearBlocks;
            };

            const initPublicationUI = () => {
                // Search and Filter Controls
                const searchIcon = document.getElementById('search-icon');
                const searchContainer = document.getElementById('search-bar-container');
                const searchInput = document.getElementById('search-input');
                const filterContainer = document.getElementById('tag-filter-container');
                const noResultsMessage = document.getElementById('no-results-message');

                const publicationsSection = document.getElementById('publications');
                const viewDetailedBtn = document.getElementById('pub-view-detailed');
                const viewCompactBtn = document.getElementById('pub-view-compact');

                const isCompactView = () => publicationsSection && publicationsSection.classList.contains('pub-compact');

                // Keep max-height values synced to real content height.
                // This restores smooth filter animations while preventing clipping when abstracts expand.
                const setMH = (el, extra = 0) => {
                    if (!el) return;
                    el.style.setProperty('--mh', (el.scrollHeight + extra) + 'px');
                };

                const getMHExtras = () => {
                    const compact = isCompactView();
                    return {
                        item: compact ? 70 : 120,
                        year: compact ? 150 : 220
                    };
                };

                const refreshPublicationHeights = () => {
                    const ex = getMHExtras();
                    document.querySelectorAll('.publication-item').forEach(el => setMH(el, ex.item));
                    document.querySelectorAll('.year-section').forEach(el => setMH(el, ex.year));
                    setMH(noResultsMessage, ex.item);
                };


                // Expand/Collapse search bar
                if (searchIcon && searchContainer && searchInput) {
                    searchIcon.addEventListener('click', () => {
                        searchContainer.classList.toggle('expanded');
                        if (searchContainer.classList.contains('expanded')) {
                            searchInput.focus();
                        }
                    });

                    // Automatically collapse search bar when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!searchContainer.contains(e.target) && searchInput.value === '') {
                            searchContainer.classList.remove('expanded');
                        }
                    });
                }

                
                // --- Publications view mode toggle (Detailed / Compact) ---
                const applyPublicationViewMode = (mode) => {
                    if (!publicationsSection) return;
                    const compact = mode === 'compact';

                    publicationsSection.classList.toggle('pub-compact', compact);

                    if (viewDetailedBtn) viewDetailedBtn.classList.toggle('active', !compact);
                    if (viewCompactBtn) viewCompactBtn.classList.toggle('active', compact);

                    // In compact view: close any opened abstracts so hidden content doesn't affect height calculations
                    if (compact && publicationsList) {
                        publicationsList.querySelectorAll('.abstract-container.show').forEach(ac => {
                            ac.classList.remove('show');
                            ac.style.maxHeight = '0px';
                        });
                        publicationsList.querySelectorAll('.abstract-toggle-btn').forEach(btn => {
                            btn.textContent = 'See Abstract';
                        });
                    }

                    requestAnimationFrame(refreshPublicationHeights);
                };

                                // Default view: Compact
                applyPublicationViewMode('compact');

if (viewDetailedBtn) {
                    viewDetailedBtn.addEventListener('click', () => {
                        try { localStorage.setItem('pubViewMode', 'detailed'); } catch (_) {}
                        applyPublicationViewMode('detailed');
                    });
                }
                if (viewCompactBtn) {
                    viewCompactBtn.addEventListener('click', () => {
                        try { localStorage.setItem('pubViewMode', 'compact'); } catch (_) {}
                        applyPublicationViewMode('compact');
                    });
                }
const filterPublications = () => {
                    const publicationItems = document.querySelectorAll('.publication-item');
                    const yearSections = document.querySelectorAll('.year-section');

                    const searchQuery = (searchInput?.value || '').toLowerCase();
                    const activeTagBtn = filterContainer?.querySelector('.tag-btn.active');
                    const selectedTag = activeTagBtn ? activeTagBtn.dataset.tag : 'all';

                    const ex = getMHExtras();

                    let visibleItemsCount = 0;

                    publicationItems.forEach(item => {
                        setMH(item, ex.item);
                        const title = item.querySelector('.publication-title')?.textContent?.toLowerCase() || '';
                        const tags = item.dataset.tags || '';

                        const searchMatch = title.includes(searchQuery);
                        const tagMatch = selectedTag === 'all' || tags.includes(selectedTag);

                        if (searchMatch && tagMatch) {
                            item.classList.remove('hidden-filter');
                            visibleItemsCount++;
                        } else {
                            item.classList.add('hidden-filter');
                        }
                    });

                    // Hide empty year sections
                    yearSections.forEach(section => {
                        setMH(section, ex.year);
                        const visibleItems = section.querySelectorAll('.publication-item:not(.hidden-filter)');
                        if (visibleItems.length > 0) {
                            section.classList.remove('hidden-filter');
                        } else {
                            section.classList.add('hidden-filter');
                        }
                    });

                    // Show/hide no results message
                    if (noResultsMessage) {
                        if (visibleItemsCount === 0) {
                            noResultsMessage.classList.remove('hidden-filter');
                        } else {
                            noResultsMessage.classList.add('hidden-filter');
                        }
                    }


                    // Sync max-heights after filtering so transitions stay smooth
                    requestAnimationFrame(refreshPublicationHeights);
                };

                // Event listeners
                if (searchInput) searchInput.addEventListener('input', filterPublications);

                if (filterContainer) {
                    filterContainer.addEventListener('click', (e) => {
                        const btn = e.target.closest('button');
                        if (btn && btn.classList.contains('tag-btn') && !btn.classList.contains('active')) {
                            const currentActive = filterContainer.querySelector('.tag-btn.active');
                            if (currentActive) currentActive.classList.remove('active');
                            btn.classList.add('active');

                            // Reset other filter buttons to default style
                            filterContainer.querySelectorAll('.tag-btn').forEach(b => {
                                if (!b.classList.contains('active')) {
                                    b.style.backgroundColor = '';
                                    b.style.color = '';
                                }
                            });

                            filterPublications();
                        }
                    });
                }

                // --- Publication Abstract Toggle (event delegation) ---
                if (publicationsList) {

                    // Helper: animate abstract open/close without clipping the parent (publication item/year-section)
                    const animateAbstract = (publicationItem, abstractContainer, open) => {
                        const yearSection = publicationItem?.closest('.year-section');

                        // Full content height (works even when collapsed)
                        const target = (abstractContainer.scrollHeight + 40);

                        // Make sure containers have enough max-height during the animation (prevents "snap back")
                        if (open) {
                            if (publicationItem) {
                                publicationItem.style.setProperty('--mh', (publicationItem.scrollHeight + target + 180) + 'px');
                            }
                            if (yearSection) {
                                yearSection.style.setProperty('--mh', (yearSection.scrollHeight + target + 260) + 'px');
                            }
                        }

                        // Clean up previous transition handler (if user clicks quickly)
                        if (abstractContainer._yk_onEnd) {
                            abstractContainer.removeEventListener('transitionend', abstractContainer._yk_onEnd);
                            abstractContainer._yk_onEnd = null;
                        }

                        const onEnd = (ev) => {
                            if (ev.propertyName !== 'max-height') return;
                            abstractContainer.removeEventListener('transitionend', onEnd);
                            abstractContainer._yk_onEnd = null;
                            // After animation settles, re-sync heights for smooth filtering + no clipping
                            requestAnimationFrame(refreshPublicationHeights);
                        };
                        abstractContainer._yk_onEnd = onEnd;
                        abstractContainer.addEventListener('transitionend', onEnd);

                        if (open) {
                            abstractContainer.classList.add('show');
                            abstractContainer.style.maxHeight = '0px';
                            // Force reflow so the browser sees 0px -> target transition
                            abstractContainer.offsetHeight;
                            abstractContainer.style.maxHeight = target + 'px';
                        } else {
                            // Set start height explicitly to avoid jumping
                            abstractContainer.style.maxHeight = (abstractContainer.scrollHeight + 40) + 'px';
                            abstractContainer.offsetHeight;
                            abstractContainer.style.maxHeight = '0px';
                            abstractContainer.classList.remove('show');
                        }
                    };

                    publicationsList.addEventListener('click', (e) => {
                        const button = e.target.closest('.abstract-toggle-btn');
                        if (!button) return;

                        const publicationItem = button.closest('.publication-item');
                        const abstractContainer = publicationItem?.querySelector('.abstract-container');
                        if (!abstractContainer) return;

                        const isVisible = abstractContainer.classList.contains('show');

                        if (isVisible) {
                            animateAbstract(publicationItem, abstractContainer, false);
                            button.textContent = 'See Abstract';
                        } else {
                            animateAbstract(publicationItem, abstractContainer, true);
                            button.textContent = 'Hide Abstract';
                        }
                    });

                    // Keep opened abstracts sized correctly on resize
                    window.addEventListener('resize', () => {
                        document.querySelectorAll('.abstract-container.show').forEach(ac => {
                            ac.style.maxHeight = (ac.scrollHeight + 40) + 'px';
                        });
                        requestAnimationFrame(refreshPublicationHeights);
                    });

                    // --- Publication thumbnail hover preview (0.5s delay) ---
                    // Shows full (uncropped) image in a floating popover.
                    const preview = document.createElement('div');
                    preview.id = 'pub-image-preview';
                    preview.innerHTML = `<div class="preview-box"><img alt="Publication preview"></div>`;
                    document.body.appendChild(preview);

                    const previewImg = preview.querySelector('img');
                    const previewBox = preview.querySelector('.preview-box');

                    let hoverTimer = null;
                    let activeThumb = null;

                    const hidePreview = () => {
                        if (hoverTimer) {
                            clearTimeout(hoverTimer);
                            hoverTimer = null;
                        }
                        if (activeThumb) {
                            activeThumb.classList.remove('preview-active');
                            activeThumb = null;
                        }
                        preview.classList.remove('show');
                    };

                    const positionPreview = (thumbEl) => {
                        if (!thumbEl) return;

                        const rect = thumbEl.getBoundingClientRect();
                        const pad = 12;

                        // Ensure we have a measurable box size
                        const w = previewBox.offsetWidth || 360;
                        const h = previewBox.offsetHeight || 260;

                        let x = rect.right + pad;
                        let y = rect.top;

                        // flip horizontally if overflowing
                        if (x + w + pad > window.innerWidth) {
                            x = rect.left - w - pad;
                        }
                        x = Math.max(pad, Math.min(x, window.innerWidth - w - pad));

                        // clamp vertically
                        if (y + h + pad > window.innerHeight) {
                            y = window.innerHeight - h - pad;
                        }
                        y = Math.max(pad, y);

                        preview.style.left = x + 'px';
                        preview.style.top = y + 'px';
                    };

                    const showPreviewFor = (thumbEl) => {
                        if (!thumbEl) return;

                        const img = thumbEl.querySelector('img');
                        // Only show if the thumbnail image exists and is visible (not removed by onerror)
                        if (!img || !img.getAttribute('src') || img.style.display === 'none') return;

                        activeThumb = thumbEl;
                        activeThumb.classList.add('preview-active');

                        previewImg.src = img.getAttribute('src');
                        previewImg.onload = () => {
                            if (activeThumb === thumbEl) positionPreview(thumbEl);
                        };

                        positionPreview(thumbEl);
                        preview.classList.add('show');
                    };

                    publicationsList.addEventListener('pointerover', (e) => {
                        // Desktop hover only
                        if (e.pointerType && e.pointerType !== 'mouse') return;

                        const thumbEl = e.target.closest('.pub-thumb');
                        if (!thumbEl) return;

                        // If hovering same thumb again, do nothing
                        if (activeThumb === thumbEl) return;

                        hidePreview();
                        hoverTimer = setTimeout(() => showPreviewFor(thumbEl), 500);
                    });

                    publicationsList.addEventListener('pointerout', (e) => {
                        if (e.pointerType && e.pointerType !== 'mouse') return;

                        const thumbEl = e.target.closest('.pub-thumb');
                        if (!thumbEl) return;

                        // Only hide when leaving the thumb element
                        if (thumbEl && !thumbEl.contains(e.relatedTarget)) {
                            hidePreview();
                        }
                    });

                    window.addEventListener('scroll', hidePreview, { passive: true });
                }

                // Initial max-height sync (prevents jumpy filter animations)
                requestAnimationFrame(refreshPublicationHeights);


            };

            const loadPublications = async () => {
                try {
                    const res = await fetch('data/publications.json', { cache: 'no-store' });
                    if (!res.ok) throw new Error(`Failed to load publications.json (${res.status})`);
                    const pubs = await res.json();

                    renderPublications(pubs);

                    if (publicationsLoading) publicationsLoading.classList.add('hidden');
                    if (publicationsContent) publicationsContent.classList.remove('hidden');

                    initPublicationUI();
                } catch (err) {
                    console.error(err);

                    if (publicationsLoading) {
                        publicationsLoading.innerHTML = `
                            <i class="fas fa-triangle-exclamation text-4xl mb-4 text-amber-500"></i>
                            <p class="text-lg font-semibold">Failed to load publications.</p>
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-500">
                                data/publications.json 를 불러오지 못했어요. GitHub Pages 같은 웹서버에서 실행하거나,
                                파일 경로/이름이 맞는지 확인해 주세요.
                            </p>
                        `;
                    }
                }
            };

            loadPublications();
        });
</script>
</body>
</html>
